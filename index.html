<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TITAN OMEGA: FINAL SYNC</title>
    <style>
        :root { --b: #050505; --g: #ffd700; --c: #00ffff; --p: #bc42f5; --r: #ff4545; }
        body { margin: 0; background: var(--b); color: #fff; font-family: 'Courier New', monospace; overflow: hidden; height: 100vh; touch-action: none; }
        
        /* Dashboard Framework */
        #header { height: 90px; border-bottom: 2px solid #333; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #111; }
        #title { font-size: 16px; color: var(--g); letter-spacing: 3px; }
        #clock { font-size: 44px; font-weight: 900; font-variant-numeric: tabular-nums; }

        #game-view { position: relative; width: 100vw; height: calc(100vh - 210px); max-width: 430px; margin: 0 auto; background: #000; overflow: hidden; border: 2px solid #222; }
        canvas { width: 100%; height: 100%; image-rendering: pixelated; }

        #footer { height: 120px; background: #111; border-top: 2px solid #333; display: grid; grid-template-columns: 1fr 1fr 1fr; align-items: center; text-align: center; }
        .val { font-size: 22px; color: var(--g); font-weight: bold; display: block; }
        .lab { font-size: 10px; color: #888; }

        /* Intro Crawl */
        #intro { position: absolute; inset: 0; background: #000; z-index: 1000; display: flex; flex-direction: column; align-items: center; padding-top: 50px; }
        .crawl-box { width: 95%; height: 35%; perspective: 120px; overflow: hidden; border-bottom: 1px solid #444; }
        .crawl-txt { position: absolute; width: 100%; text-align: center; color: var(--g); font-size: 20px; line-height: 1.8; animation: crawlSlow 40s linear forwards; }
        @keyframes crawlSlow { 0% { transform: rotateX(20deg) translateY(350px); } 100% { transform: rotateX(20deg) translateY(-1500px); } }

        /* Combat HUD */
        #hp-frame { position: absolute; top: 15px; left: 10%; width: 80%; height: 14px; border: 2px solid #fff; background: #200; z-index: 100; }
        #hp-bar { height: 100%; width: 100%; background: linear-gradient(90deg, var(--r), #ff8c00); transition: width 0.2s; }
        #pre-timer { position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; align-items: center; justify-content: center; font-size: 180px; font-weight: 900; color: var(--c); }

        /* Premium Reward Screen */
        #loot { position: absolute; inset: 0; background: rgba(0,0,0,0.98); z-index: 3000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .crystal { width: 100px; height: 140px; background: var(--p); clip-path: polygon(50% 0, 100% 30%, 100% 70%, 50% 100%, 0 70%, 0 30%); animation: gemSpin 3s infinite linear; border: 4px solid #fff; box-shadow: 0 0 50px var(--p); }
        @keyframes gemSpin { 0% { transform: rotateY(0) scale(1); filter: brightness(1); } 50% { transform: rotateY(180deg) scale(1.2); filter: brightness(1.5); } 100% { transform: rotateY(360deg) scale(1); filter: brightness(1); } }

        /* Parent Dashboard */
        #admin { position: absolute; inset: 0; background: #111; z-index: 4000; display: none; padding: 40px; }
        input { background: #000; border: 2px solid var(--c); color: var(--c); padding: 12px; font-size: 18px; width: 80%; margin: 10px 0; }
        .btn { padding: 15px 30px; background: var(--p); border: none; color: #fff; font-weight: bold; cursor: pointer; text-transform: uppercase; margin-top: 10px; }
        
        #secret { position: absolute; bottom: 0; right: 0; width: 70px; height: 70px; z-index: 5000; }
    </style>
</head>
<body>

<div id="intro">
    <div class="crawl-box">
        <div class="crawl-txt">
            ALERT PILOT:<br><br>THE CYBORG TITAN CORE IS UNSTABLE.<br><br>
            ENGAGE NEURAL SYNC FOR 120 SECONDS TO TRIGGER DESTRUCTION.<br><br>
            MAINTAIN BRUSHING FREQUENCY TO PIERCE THE ARMOUR.<br><br>
            REWARD: 100 PURPLE KINETIC CRYSTALS.
        </div>
    </div>
    <div style="margin-top:30px; text-align:center;">
        <input type="text" id="nameIn" placeholder="PILOT NAME" style="background:#000; border:2px solid var(--c); color:var(--c); padding:12px; text-align:center; margin-bottom:15px;">
        <br>
        <button id="engageBtn" class="btn" style="background:var(--c); color:#000;">Engage Neural Link</button>
    </div>
</div>

<div id="pre-timer">5</div>

<div id="header">
    <div id="title">TITAN OMEGA: MISSION ACTIVE</div>
    <div id="clock">02:00</div>
</div>

<div id="game-view">
    <div id="hp-frame"><div id="hp-bar"></div></div>
    <canvas id="c"></canvas>
</div>

<div id="footer">
    <div class="stat"><span class="lab">PILOT</span><span class="val" id="ui-n">---</span></div>
    <div class="stat"><span class="lab">STREAK</span><span class="val" id="ui-s">0</span></div>
    <div class="stat"><span class="lab">CRYSTALS</span><span class="val" id="ui-c">0</span></div>
</div>

<div id="loot">
    <h1 style="color:var(--p); letter-spacing:5px;">MISSION COMPLETE</h1>
    <div class="crystal"></div>
    <h2 style="margin-top:30px;">+100 CRYSTALS SYNCED</h2>
    <button class="btn" onclick="location.reload()">Return to Hangar</button>
</div>

<div id="admin">
    <h2>COMMAND OVERRIDE</h2>
    <label>Crystals:</label><input type="number" id="ad-c">
    <label>Streak:</label><input type="number" id="ad-s">
    <button class="btn" onclick="saveAd()">Save & Reboot</button>
    <button class="btn" style="background:#444" onclick="document.getElementById('admin').style.display='none'">Cancel</button>
</div>

<div id="secret"></div>

<script>
/**
 * OMEGA-MAX ENGINE: 16-BIT HIGH FIDELITY
 */
const cv = document.getElementById('c');
const ctx = cv.getContext('2d');
const engageBtn = document.getElementById('engageBtn');

let state = {
    active: false, t: 120, start: 0, f: 0,
    cry: parseInt(localStorage.getItem('gba_crystals_v1')) || 0,
    str: parseInt(localStorage.getItem('gba_streak_v1')) || 0,
    stars: [], lasers: []
};

// MULTI-INPUT BINDING FOR iOS SAFARI
const startSequence = (e) => {
    e.preventDefault();
    const name = document.getElementById('nameIn').value || "PILOT";
    document.getElementById('ui-n').innerText = name.toUpperCase();
    document.getElementById('ui-c').innerText = state.cry;
    document.getElementById('ui-s').innerText = state.str;
    document.getElementById('intro').style.display = 'none';
    
    const pt = document.getElementById('pre-timer');
    pt.style.display = 'flex';
    let count = 5;
    const cd = setInterval(() => {
        count--; pt.innerText = count;
        if(count <= 0) {
            clearInterval(cd);
            pt.style.display = 'none';
            launch();
        }
    }, 1000);
};

engageBtn.addEventListener('touchstart', startSequence);
engageBtn.addEventListener('click', startSequence);

function launch() {
    cv.width = 430; cv.height = 700;
    for(let i=0; i<100; i++) state.stars.push({x: Math.random()*430, y: Math.random()*700, v: Math.random()*15+5, a: Math.random()});
    state.active = true; state.start = performance.now();
    requestAnimationFrame(loop);
}

function drawHero(x, y) {
    const bob = Math.sin(state.f * 0.15) * 6;
    // Layered Megaman Sprite
    ctx.fillStyle = '#0055ff'; ctx.fillRect(x, y + bob, 45, 55); // Body
    ctx.fillStyle = '#00ffff'; ctx.fillRect(x+8, y+8+bob, 30, 18); // Visor
    ctx.fillStyle = '#fff'; ctx.globalAlpha = 0.4; ctx.fillRect(x+12, y+10+bob, 12, 4); // Highlight
    ctx.globalAlpha = 1;
    // Cannon + Fire
    ctx.fillStyle = '#222'; ctx.fillRect(x+40, y+25+bob, 25, 15);
    if(state.f % 8 === 0) {
        state.lasers.push({x: x+65, y: y+32+bob});
        ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(x+65, y+32+bob, 12, 0, 7); ctx.fill();
    }
}

function drawTitan(x, y) {
    const pulse = Math.sin(state.f * 0.08) * 10;
    ctx.fillStyle = '#1a1a1a'; ctx.fillRect(x, y, 130, 130);
    ctx.strokeStyle = '#333'; ctx.lineWidth = 4; ctx.strokeRect(x, y, 130, 130);
    // Glowing Core
    const coreGlow = Math.floor(150 + Math.sin(state.f*0.1)*100);
    ctx.fillStyle = `rgb(${coreGlow}, 0, 0)`;
    ctx.beginPath(); ctx.arc(x+65, y+65, 35 + pulse/2, 0, 7); ctx.fill();
    // Sentinel Eyes
    ctx.fillStyle = (state.f % 40 < 20) ? '#ff0000' : '#440000';
    ctx.fillRect(x+25, y+25, 25, 12); ctx.fillRect(x+80, y+25, 25, 12);
}

function loop(now) {
    if(!state.active) return;
    state.t = 120 - (now - state.start)/1000;
    if(state.t <= 0) return victory();
    state.f++;

    // Chrono-Sync Dashboard
    const sec = Math.floor(state.t % 60);
    document.getElementById('clock').innerText = `0${Math.floor(state.t/60)}:${sec < 10 ? '0'+sec : sec}`;
    document.getElementById('hp-bar').style.width = (state.t/120)*100 + "%";

    ctx.fillStyle = '#000'; ctx.fillRect(0,0,430,700);

    // High-Speed Warp Stars
    state.stars.forEach(s => {
        s.y += s.v; if(s.y > 700) { s.y = -20; s.x = Math.random()*430; }
        ctx.fillStyle = `rgba(255,255,255,${s.a})`;
        ctx.fillRect(s.x, s.y, 2, 2);
    });

    drawTitan(150 + Math.sin(state.f*0.04)*70, 100 + Math.cos(state.f*0.03)*40);
    drawHero(190 + Math.sin(state.f*0.06)*50, 530);

    // Laser Physics
    state.lasers.forEach((l, i) => {
        l.y -= 25; 
        ctx.fillStyle = (state.f % 2 === 0) ? '#fff' : '#00ffff';
        ctx.fillRect(l.x, l.y, 4, 30);
        if(l.y < 0) state.lasers.splice(i, 1);
    });

    requestAnimationFrame(loop);
}

function victory() {
    state.active = false; state.cry += 100; state.str += 1;
    localStorage.setItem('gba_crystals_v1', state.cry);
    localStorage.setItem('gba_streak_v1', state.str);
    document.getElementById('loot').style.display = 'flex';
}

/* Hidden Admin Commands */
let taps = 0;
document.getElementById('secret').addEventListener('touchstart', (e) => {
    e.preventDefault(); taps++;
    if(taps >= 5) {
        const p = prompt("ADMIN PIN:");
        if(p === "1234") {
            document.getElementById('admin').style.display = 'block';
            document.getElementById('ad-c').value = state.cry;
            document.getElementById('ad-s').value = state.str;
        }
        taps = 0;
    }
});
function saveAd() {
    localStorage.setItem('gba_crystals_v1', document.getElementById('ad-c').value);
    localStorage.setItem('gba_streak_v1', document.getElementById('ad-s').value);
    location.reload();
}
</script>
</body>
</html>
