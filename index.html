<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tooth Ranger: Plaque Planet</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0c1022;
  --panel:#141a35;
  --accent:#00f5ff;
  --danger:#ff3b3b;
  --glow:0 0 12px rgba(0,245,255,0.7);
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:radial-gradient(circle at top,#12183b,#070a18);
  font-family:'Inter',sans-serif;
  color:white;
  display:flex;
  justify-content:center;
}
.app{
  width:100%;
  max-width:420px;
  min-height:100vh;
  padding:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
}
h1{
  font-family:'Press Start 2P';
  font-size:14px;
  text-align:center;
  margin-bottom:20px;
  color:var(--accent);
  text-shadow:var(--glow);
}
input{
  padding:10px;
  border-radius:8px;
  border:none;
  margin-bottom:10px;
  width:100%;
}
button{
  padding:12px;
  margin:6px;
  border:none;
  border-radius:10px;
  font-weight:600;
  background:var(--panel);
  color:white;
  box-shadow:0 0 8px rgba(0,0,0,0.4);
}
button.primary{
  background:var(--accent);
  color:#000;
}
button.danger{
  background:var(--danger);
}
.timer{
  font-size:42px;
  margin:20px 0;
  transition:0.2s;
}
.timer.red{
  color:var(--danger);
  animation:flash 0.6s infinite;
}
@keyframes flash{
  0%{opacity:1}
  50%{opacity:0.3}
  100%{opacity:1}
}
.zone{
  font-size:12px;
  margin-bottom:10px;
  color:var(--accent);
}
.canvas-wrap{
  width:100%;
  height:200px;
  background:linear-gradient(#1b214a,#0b0f23);
  border-radius:16px;
  overflow:hidden;
  position:relative;
  box-shadow:0 0 20px rgba(0,0,0,0.6);
}
canvas{
  width:100%;
  height:100%;
}
.stats{
  margin-top:10px;
  font-size:12px;
  text-align:center;
}
.parent{
  margin-top:auto;
  font-size:10px;
  opacity:0.6;
}
.loot{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}
.loot h2{
  font-family:'Press Start 2P';
  font-size:14px;
  margin-bottom:20px;
}
.crystal{
  font-size:40px;
  animation:spin 2s linear infinite;
}
@keyframes spin{
  0%{transform:rotate(0deg)}
  100%{transform:rotate(360deg)}
}
</style>
</head>
<body>
<div class="app">
<h1>TOOTH RANGER</h1>

<input id="nameInput" placeholder="Enter Ranger Name">

<div class="timer" id="timer">2:00</div>
<div class="zone" id="zoneText"></div>

<div class="canvas-wrap">
<canvas id="game"></canvas>
</div>

<div>
<button class="primary" onclick="startMission()">Start</button>
<button onclick="pauseMission()">Pause</button>
<button class="danger" onclick="resetMission()">Reset</button>
</div>

<div class="stats" id="stats"></div>

<div class="parent">
<button onclick="parentPrompt()">Parent Controls</button>
</div>
</div>

<div class="loot" id="lootBox">
<h2>MISSION COMPLETE</h2>
<div class="crystal">ðŸ’Ž</div>
<p id="lootText"></p>
<button onclick="closeLoot()">Continue</button>
</div>

<script>
const TOTAL_TIME=120;
let time=TOTAL_TIME;
let interval=null;
let running=false;
let zoneIndex=0;
let crystals=Number(localStorage.getItem("crystals")||0);
let streak=Number(localStorage.getItem("streak")||0);
let daily=Number(localStorage.getItem("daily")||0);
let lastDate=localStorage.getItem("lastDate")||"";

const zones=[
"Clear Upper Left Sector",
"Clear Upper Right Sector",
"Clear Lower Left Sector",
"Destroy Core Chamber"
];

const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=400;
canvas.height=200;

function saveData(){
localStorage.setItem("crystals",crystals);
localStorage.setItem("streak",streak);
localStorage.setItem("daily",daily);
localStorage.setItem("lastDate",lastDate);
}

function updateStats(){
document.getElementById("stats").innerHTML=
`Crystals: ${crystals} | Streak: ${streak} | Today: ${daily}`;
}

function startMission(){
if(running)return;
let count=5;
document.getElementById("timer").textContent="Mission in 5";
let pre=setInterval(()=>{
count--;
if(count>0){
document.getElementById("timer").textContent="Mission in "+count;
}else{
clearInterval(pre);
beginCountdown();
}
},1000);
}

function beginCountdown(){
running=true;
time=TOTAL_TIME;
interval=setInterval(()=>{
if(!running)return;
time--;
updateTimer();
updateZone();
draw();
if(time<=0){
clearInterval(interval);
completeMission();
}
},1000);
}

function pauseMission(){
running=!running;
}

function resetMission(){
clearInterval(interval);
running=false;
time=TOTAL_TIME;
zoneIndex=0;
updateTimer();
draw();
}

function updateTimer(){
let m=Math.floor(time/60);
let s=time%60;
document.getElementById("timer").textContent=
`${m}:${s.toString().padStart(2,"0")}`;
if(time<=10){
document.getElementById("timer").classList.add("red");
beep();
}else{
document.getElementById("timer").classList.remove("red");
}
}

function updateZone(){
zoneIndex=Math.floor((TOTAL_TIME-time)/30);
if(zoneIndex<zones.length){
document.getElementById("zoneText").textContent=zones[zoneIndex];
}
}

function completeMission(){
running=false;
let today=new Date().toDateString();
if(today!==lastDate){
daily++;
if(new Date(today)-new Date(lastDate)===86400000){
streak++;
}else{
streak=1;
}
lastDate=today;
}
let reward=Math.floor(Math.random()*15)+10;
crystals+=reward;
saveData();
updateStats();
showLoot(reward);
}

function showLoot(amount){
document.getElementById("lootText").textContent=
`You earned ${amount} Energy Crystals`;
document.getElementById("lootBox").style.display="flex";
}

function closeLoot(){
document.getElementById("lootBox").style.display="none";
resetMission();
}

function parentPrompt(){
let d=prompt("Adjust daily count:");
let s=prompt("Adjust streak:");
if(d!==null)daily=Number(d);
if(s!==null)streak=Number(s);
saveData();
updateStats();
}

function beep(){
let ctxAudio=new(window.AudioContext||window.webkitAudioContext)();
let osc=ctxAudio.createOscillator();
osc.type="square";
osc.frequency.setValueAtTime(880,ctxAudio.currentTime);
osc.connect(ctxAudio.destination);
osc.start();
osc.stop(ctxAudio.currentTime+0.1);
}

function draw(){
ctx.clearRect(0,0,400,200);

/* Hero */
ctx.fillStyle="#00f5ff";
ctx.fillRect(60,120,20,40);

/* Robot boss damage phases */
let damage=(TOTAL_TIME-time)/TOTAL_TIME;
ctx.fillStyle=damage<0.5?"#888":damage<0.8?"#ff9900":"#ff3b3b";
ctx.fillRect(280,80,60,80);

if(damage>0.5){
ctx.fillStyle="black";
ctx.fillRect(290,90,40,10);
}
if(damage>0.8){
ctx.fillStyle="yellow";
ctx.fillRect(305,110,10,10);
}
}

updateTimer();
updateStats();
draw();
</script>
</body>
</html>
