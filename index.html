<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TITAN SCRUB EX</title>
    <style>
        :root {
            --c-0: transparent; --c-1: #000000; --c-2: #0ff6ff; --c-3: #00b3b3;
            --c-4: #bfefff; --c-5: #ffd24d; --c-6: #ffb36b; --c-7: #ff6b6b;
            --c-8: #444444; --c-9: #999999; --c-10: #222222; --c-11: #ffffff;
        }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #08080a; overflow: hidden; 
            font-family: 'Courier New', monospace;
        }
        #stage {
            position: relative; width: 100vw; height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }
        canvas { 
            width: 100%; height: 100%; image-rendering: pixelated; 
            background: radial-gradient(circle, #1a1a2e 0%, #08080a 100%);
        }
        
        /* UI OVERLAY */
        #hud-top {
            position: absolute; top: 40px; width: 85%;
            display: flex; flex-direction: column; gap: 10px;
        }
        .bar-container {
            height: 24px; background: rgba(0,0,0,0.5); border: 2px solid var(--c-8);
            position: relative; box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        #hp-bar {
            width: 100%; height: 100%; background: linear-gradient(90deg, var(--c-7), #a00);
            transition: width 0.3s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }
        #sector-dots {
            display: flex; gap: 5px; margin-top: 5px;
        }
        .dot { width: 15px; height: 6px; background: var(--c-10); border: 1px solid var(--c-8); }
        .dot.active { background: var(--c-2); box-shadow: 0 0 8px var(--c-2); }

        #prompt-box {
            position: absolute; bottom: 15%; width: 100%; text-align: center;
            color: var(--c-11); font-weight: bold; text-shadow: 2px 2px var(--c-1);
            letter-spacing: 2px; pointer-events: none;
        }
        .glitch { animation: flash 0.5s infinite; font-size: 24px; }
        
        @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        #start-screen {
            position: absolute; inset: 0; background: rgba(0,0,0,0.9);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100;
        }
        .btn-ready {
            background: var(--c-5); border: none; padding: 20px 50px;
            font-size: 24px; font-weight: 900; color: #000;
            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
            cursor: pointer; transform: scale(1); transition: 0.2s;
        }
        .btn-ready:active { transform: scale(0.9); }
    </style>
</head>
<body>

<div id="stage">
    <canvas id="game"></canvas>
    
    <div id="hud-top">
        <div style="display: flex; justify-content: space-between; color: var(--c-5); font-size: 12px; font-weight: bold;">
            <span>TITAN_CORRUPTION</span>
            <span id="percent-txt">100%</span>
        </div>
        <div class="bar-container"><div id="hp-bar"></div></div>
        <div id="sector-dots">
            <div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>
    </div>

    <div id="prompt-box">
        <div id="zone-label" class="glitch" style="color: var(--c-2);">FRONT CANINES</div>
        <div style="font-size: 10px; color: var(--c-9); margin-top: 5px;">MANUAL SCRUB IN PROGRESS...</div>
    </div>

    <div id="start-screen">
        <div style="color: var(--c-2); font-size: 40px; font-weight: 900; margin-bottom: 5px;">TITAN SCRUB</div>
        <div style="color: var(--c-5); font-size: 14px; margin-bottom: 40px;">MISSION: 120 SECONDS TO DECONTAMINATE</div>
        <button class="btn-ready" onclick="startEngine()">INITIATE</button>
    </div>
</div>

<script>
/** 
 * BITMASK DATA
 * 0:trans, 1:black, 2:cyan, 5:gold, 8:metal, 9:plate, 10:shadow, 11:white
 */
const SPRITES = {
    hero: [
        [0,0,0,9,9,9,0,0,0],
        [0,0,9,11,11,9,9,0,0],
        [0,9,9,2,2,2,9,9,0], // Visor layer
        [9,9,9,2,2,2,9,9,9],
        [8,8,9,9,9,9,9,8,8],
        [0,8,8,5,5,5,8,8,0],
        [0,0,8,8,8,8,8,0,0]
    ],
    boss: [
        [0,1,1,1,1,1,1,0],
        [1,9,9,9,9,9,9,1],
        [1,9,7,7,7,7,9,1], // Core
        [1,9,7,11,11,7,9,1],
        [1,9,7,7,7,7,9,1],
        [1,9,9,9,9,9,9,1],
        [0,1,1,1,1,1,1,0]
    ]
};

const PALETTE = ["", "#000000", "#0ff6ff", "#00b3b3", "#bfefff", "#ffd24d", "#ffb36b", "#ff6b6b", "#444444", "#999999", "#222222", "#ffffff"];
const ZONES = ["LOWER LEFT", "LOWER RIGHT", "UPPER LEFT", "UPPER RIGHT", "FRONT TEETH"];

let canvas = document.getElementById('game');
let ctx = canvas.getContext('2d');
let audioCtx;
let state = {
    active: false,
    time: 120,
    maxTime: 120,
    frame: 0,
    shake: 0,
    particles: [],
    zoneIdx: 0
};

function setupCanvas() {
    canvas.width = window.innerWidth * window.devicePixelRatio;
    canvas.height = window.innerHeight * window.devicePixelRatio;
    ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
    ctx.imageSmoothingEnabled = false;
}

function beep(freq, dur) {
    if(!audioCtx) return;
    let osc = audioCtx.createOscillator();
    let gain = audioCtx.createGain();
    osc.type = 'square';
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + dur);
}

function drawMask(data, x, y, size) {
    data.forEach((row, ri) => {
        row.forEach((pixel, pi) => {
            if(pixel === 0) return;
            ctx.fillStyle = PALETTE[pixel];
            ctx.fillRect(x + (pi * size), y + (ri * size), size, size);
        });
    });
}

function update() {
    if(!state.active) return;
    
    state.frame++;
    state.time -= 1/60;
    
    // Logic: Progression
    const progress = state.time / state.maxTime;
    const hpPercent = Math.ceil(progress * 100);
    document.getElementById('hp-bar').style.width = hpPercent + "%";
    document.getElementById('percent-txt').innerText = hpPercent + "%";
    
    // Zone Switching
    let newZone = Math.floor((1 - progress) * 5);
    if(newZone !== state.zoneIdx && newZone < 5) {
        state.zoneIdx = newZone;
        document.getElementById('zone-label').innerText = ZONES[state.zoneIdx];
        const dots = document.querySelectorAll('.dot');
        dots.forEach((d, i) => d.classList.toggle('active', i === state.zoneIdx));
        state.shake = 20;
        beep(440, 0.2); beep(880, 0.2);
    }

    // Particle Burst
    if(state.frame % 2 === 0) {
        state.particles.push({
            x: window.innerWidth/2, y: 250, 
            vx: (Math.random()-0.5)*15, vy: (Math.random()-0.5)*15, 
            l: 1.0, c: Math.random() > 0.5 ? 2 : 11
        });
    }

    render();
    requestAnimationFrame(update);
}

function render() {
    const w = window.innerWidth;
    const h = window.innerHeight;
    ctx.clearRect(0, 0, w, h);

    // Juice: Screen Shake
    if(state.shake > 0) {
        ctx.translate((Math.random()-0.5)*state.shake, (Math.random()-0.5)*state.shake);
        state.shake *= 0.9;
    }

    // Draw Boss (The Plaque Titan)
    const bSize = 25;
    const bX = w/2 - (SPRITES.boss[0].length * bSize)/2;
    const bY = 150 + Math.sin(state.frame * 0.05) * 10;
    
    // Ghosting effect
    ctx.globalAlpha = 0.3;
    drawMask(SPRITES.boss, bX + Math.sin(state.frame*0.1)*5, bY, bSize);
    ctx.globalAlpha = 1.0;
    drawMask(SPRITES.boss, bX, bY, bSize);

    // Draw Hero (The Exo-Scrubber)
    const hSize = 12;
    const hX = w/2 - (SPRITES.hero[0].length * hSize)/2;
    const hY = h - 250 + Math.sin(state.frame * 0.1) * 5;
    
    // Beam
    ctx.strokeStyle = state.frame % 2 === 0 ? PALETTE[2] : PALETTE[11];
    ctx.lineWidth = 8;
    ctx.beginPath();
    ctx.moveTo(w/2, hY);
    ctx.lineTo(w/2 + Math.sin(state.frame*0.3)*30, bY + 100);
    ctx.stroke();

    drawMask(SPRITES.hero, hX, hY, hSize);

    // Particles
    state.particles.forEach((p, i) => {
        ctx.fillStyle = PALETTE[p.c];
        ctx.fillRect(p.x, p.y, 4, 4);
        p.x += p.vx; p.y += p.vy; p.l -= 0.02;
        if(p.l <= 0) state.particles.splice(i, 1);
    });

    ctx.setTransform(window.devicePixelRatio, 0, 0, window.devicePixelRatio, 0, 0);
}

function startEngine() {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    state.active = true;
    document.getElementById('start-screen').style.display = 'none';
    beep(600, 0.1);
    setTimeout(() => beep(800, 0.1), 100);
    update();
}

window.addEventListener('resize', setupCanvas);
setupCanvas();
</script>
</body>
</html>
