<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>METROID BRUSH: 10,000,000% ULTIMATE</title>
    <style>
        :root {
            --p-blue: #00f2ff; --p-pink: #ff00ff; --p-orange: #ff7b00;
            --p-gold: #ffd700; --p-red: #ff2222; --p-bg: #020205;
            --notch: env(safe-area-inset-top);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; }
        body { background: var(--p-bg); color: #fff; font-family: 'Courier New', monospace; overflow: hidden; height: 100vh; display: flex; justify-content: center; }
        
        #viewport {
            position: relative; width: 100vw; height: 100vh; max-width: 430px; 
            background: #000; overflow: hidden; border-left: 1px solid #222; border-right: 1px solid #222;
        }

        /* 1999 ARCADE CRT SCANLINE SHADER */
        #viewport::after {
            content: ""; position: absolute; inset: 0; z-index: 9999; pointer-events: none;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%),
                        linear-gradient(90deg, rgba(255, 0, 0, 0.02), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.02));
            background-size: 100% 4px, 3px 100%;
        }

        canvas { display: block; image-rendering: pixelated; }

        /* HUD ELEMENTS */
        .hud { position: absolute; inset: 0; z-index: 1000; pointer-events: none; padding: calc(var(--notch) + 15px) 20px; }
        .hud-top { display: flex; justify-content: space-between; align-items: flex-start; }
        .hud-box { background: rgba(0, 15, 40, 0.85); border: 2px solid var(--p-blue); padding: 6px 12px; font-size: 11px; color: var(--p-blue); text-transform: uppercase; letter-spacing: 2px; box-shadow: inset 0 0 15px var(--p-blue); }
        #timer-val { font-size: 56px; font-weight: 900; color: var(--p-gold); text-shadow: 0 0 20px var(--p-gold); text-align: center; }
        .hp-meter { width: 100%; height: 16px; background: #300; border: 2px solid #f00; margin-top: 10px; position: relative; }
        #hp-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #f00, #ff7b00); transition: width 0.1s linear; }

        /* CINEMATIC OVERLAYS */
        .screen { position: absolute; inset: 0; z-index: 2000; background: rgba(0,0,0,0.98); display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 40px; }
        h1 { font-size: 48px; color: var(--p-orange); text-shadow: 4px 4px #000, 0 0 20px var(--p-orange); margin-bottom: 5px; }
        .btn-prime { background: var(--p-orange); border: 4px solid #fff; padding: 25px 60px; font-size: 26px; font-weight: 900; color: #fff; cursor: pointer; box-shadow: 0 12px 0 #830; text-transform: uppercase; border-radius: 2px; transition: 0.1s; }
        .btn-prime:active { transform: translateY(4px); box-shadow: 0 8px 0 #830; }
        .hidden { display: none !important; }

        /* REWARD ANIMATIONS */
        #loot-box { font-size: 120px; margin: 30px; cursor: pointer; filter: drop-shadow(0 0 30px var(--p-gold)); animation: float 2s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-30px); } }

        /* PARENTAL TOOLS */
        #parent-trigger { position: absolute; bottom: 0; right: 0; width: 80px; height: 80px; z-index: 5000; opacity: 0; }
    </style>
</head>
<body>

<div id="viewport">
    <div class="hud">
        <div class="hud-top">
            <div class="hud-box">MISSION: ELITE-V</div>
            <div class="hud-box">STREAK: <span id="ui-streak">0</span></div>
        </div>
        <div id="timer-val">02:00</div>
        <div class="hp-meter"><div id="hp-fill"></div></div>
        <div class="hud-top" style="margin-top: 5px; padding: 0;">
            <div style="font-size: 9px; color: var(--p-red); letter-spacing: 3px;">BOSS: OMEGA-VIRUS IV</div>
            <div style="font-size: 9px; color: var(--p-gold);">CRYSTALS: <span id="ui-cry">0</span></div>
        </div>
    </div>

    <canvas id="gameStage"></canvas>

    <div id="scr-start" class="screen">
        <div style="font-size: 14px; color: var(--p-blue); letter-spacing: 6px; margin-bottom: 10px;">GALACTIC HYGIENE CORPS</div>
        <h1>METROID<br><span style="font-size: 36px; color: #fff;">BRUSH ELITE</span></h1>
        <button class="btn-prime" onclick="Engine.init()">INITIATE MISSION</button>
        <p style="margin-top: 40px; font-size: 10px; color: #444;">ULTRA-PREMIUM 16-BIT EXPERIENCE</p>
    </div>

    <div id="scr-win" class="screen hidden">
        <h2 style="color: var(--p-gold); font-size: 38px; text-shadow: 0 0 20px var(--p-gold);">CORE SECURED</h2>
        <div id="loot-box" onclick="Engine.openLoot()">üéÅ</div>
        <div id="win-details" class="hidden">
            <p id="loot-msg" style="color: var(--p-blue); font-size: 20px; font-weight: 900;"></p>
            <button class="btn-prime" style="margin-top: 20px;" onclick="location.reload()">RETURN TO BASE</button>
        </div>
    </div>

    <!-- HIDDEN PARENTAL HOTSPOT -->
    <div id="parent-trigger" onclick="Engine.showParent()"></div>
</div>

<script>
/**
 * METROID BRUSH: 10,000,000% MASTER ENGINE
 * Built for iPhone 15 Safari v17.x
 */

const Engine = {
    running: false, timer: 120, lastT: 0, shake: 0,
    save: JSON.parse(localStorage.getItem('metroid_brush_ultra')) || { streak: 0, cry: 0, last: null },
    
    // Physics & Entites
    stars: [], nebula: [], particles: [], bullets: [],
    hero: { x: 80, y: 0, w: 48, h: 72, anim: 0, overdrive: false },
    boss: { x: 0, y: 0, w: 140, h: 200, hp: 3000, max: 3000, flash: 0, float: 0 },

    init() {
        document.getElementById('scr-start').classList.add('hidden');
        this.canvas = document.getElementById('gameStage');
        this.ctx = this.canvas.getContext('2d', { alpha: false });
        this.resize();
        
        // Parallax Stars Generation
        for(let i=0; i<200; i++) {
            this.stars.push({
                x: Math.random() * this.canvas.width,
                y: Math.random() * this.canvas.height,
                z: Math.random() * 6 + 1,
                o: Math.random(),
                c: i % 5 === 0 ? '#ff00ff' : '#00f2ff'
            });
        }

        window.onresize = () => this.resize();
        this.updateHUD();
        this.running = true;
        this.lastT = performance.now();
        requestAnimationFrame((t) => this.loop(t));
    },

    resize() {
        this.canvas.width = window.innerWidth > 430 ? 430 : window.innerWidth;
        this.canvas.height = window.innerHeight;
        this.hero.y = this.canvas.height - 240;
        this.boss.x = this.canvas.width - 160;
    },

    loop(t) {
        if(!this.running) return;
        const dt = (t - this.lastT) / 1000;
        this.lastT = t;
        this.update(dt);
        this.render();
        requestAnimationFrame((nt) => this.loop(nt));
    },

    update(dt) {
        this.timer -= dt;
        if(this.timer <= 0) this.win();

        // Overdrive Phase (Final 30s)
        this.hero.overdrive = this.timer < 30;
        if(this.shake > 0) this.shake *= 0.92;

        // Background Motion
        this.stars.forEach(s => {
            s.y += s.z * (this.hero.overdrive ? 2.5 : 1.2);
            if(s.y > this.canvas.height) s.y = -10;
        });

        // Samus Logic (Auto-Strafing)
        this.hero.anim += dt * (this.hero.overdrive ? 10 : 5);
        this.hero.y = (this.canvas.height - 240) + Math.sin(this.hero.anim/2) * 25;
        
        // Auto-Firing Engine
        const fireRate = this.hero.overdrive ? 0.97 : 0.94;
        if(Math.random() > fireRate) {
            this.bullets.push({ 
                x: this.hero.x + 45, 
                y: this.hero.y + 30, 
                v: 25, 
                c: this.hero.overdrive ? '#ffd700' : 'cyan' 
            });
        }

        // Boss AI Movement
        this.boss.float += dt * 1.5;
        this.boss.y = 200 + Math.sin(this.boss.float) * 70;
        if(this.boss.flash > 0) this.boss.flash--;

        // Collision & Physics
        this.bullets.forEach((b, i) => {
            b.x += b.v;
            if(b.x > this.boss.x && b.y > this.boss.y && b.y < this.boss.y + 200) {
                this.boss.hp -= this.hero.overdrive ? 15 : 10;
                this.boss.flash = 6;
                this.shake = this.hero.overdrive ? 12 : 5;
                this.spawnParticles(b.x, b.y, '#ffd700', 10);
                this.bullets.splice(i, 1);
            }
            if(b.x > this.canvas.width) this.bullets.splice(i, 1);
        });

        this.particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy;
            p.vy += 0.3; // High-res gravity
            p.life -= 0.03;
            if(p.life <= 0) this.particles.splice(i, 1);
        });

        this.syncHUD();
    },

    spawnParticles(x, y, color, count) {
        for(let i=0; i<count; i++) {
            this.particles.push({
                x, y, vx: Math.random()*10, vy: (Math.random()-0.5)*15, 
                life: 1.0, color: i % 2 === 0 ? color : '#ff00ff'
            });
        }
    },

    syncHUD() {
        const m = Math.floor(Math.max(0, this.timer) / 60);
        const s = Math.floor(Math.max(0, this.timer) % 60);
        const el = document.getElementById('timer-val');
        el.innerText = `${m}:${s < 10 ? '0'+s : s}`;
        document.getElementById('hp-fill').style.width = (this.boss.hp / 3000 * 100) + "%";
        
        if(this.timer <= 10) {
            el.style.color = "var(--p-red)";
            if(Math.floor(Date.now()/150) % 2 === 0) {
                this.ctx.fillStyle = "rgba(255,0,0,0.15)";
                this.ctx.fillRect(0,0,this.canvas.width, this.canvas.height);
            }
        }
    },

    render() {
        const ctx = this.ctx;
        ctx.save();
        if(this.shake > 1) ctx.translate((Math.random()-0.5)*this.shake, (Math.random()-0.5)*this.shake);

        ctx.fillStyle = '#000'; ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

        // Stars
        this.stars.forEach(s => {
            ctx.fillStyle = s.c; ctx.globalAlpha = s.o;
            ctx.fillRect(s.x, s.y, s.z/2.5, s.z/2.5);
        });
        ctx.globalAlpha = 1.0;

        // SAMUS (ELITE RENDERING)
        const h = this.hero;
        ctx.fillStyle = h.overdrive ? '#ffd700' : '#ff7b00';
        ctx.fillRect(h.x, h.y, h.w, h.h);
        ctx.fillStyle = '#00ff41'; ctx.fillRect(h.x + 30, h.y + 14, 20, 10); // Visor
        ctx.fillStyle = '#666'; ctx.fillRect(h.x + 38, h.y + 28, 30, 16); // Cannon

        // BOSS (OMEGA VIRUS)
        const b = this.boss;
        ctx.fillStyle = b.flash > 0 ? '#fff' : '#222';
        ctx.fillRect(b.x, b.y, b.w, b.h);
        ctx.fillStyle = 'red'; ctx.beginPath();
        ctx.arc(b.x + 50, b.y + 70, 30 + Math.sin(Date.now()/100)*10, 0, Math.PI*2);
        ctx.fill();

        // Bullets & FX
        ctx.shadowBlur = 15; ctx.shadowColor = 'cyan';
        ctx.fillStyle = 'cyan'; this.bullets.forEach(bul => ctx.fillRect(bul.x, bul.y, 25, 8));
        ctx.shadowBlur = 0;
        this.particles.forEach(p => {
            ctx.fillStyle = p.color; ctx.globalAlpha = p.life;
            ctx.fillRect(p.x, p.y, 5, 5);
        });
        ctx.globalAlpha = 1.0;
        ctx.restore();
    },

    win() {
        this.running = false;
        document.getElementById('scr-win').classList.remove('hidden');
    },

    openLoot() {
        const earned = 200 + (this.save.streak * 50);
        this.save.cry += earned;
        const today = new Date().toDateString();
        if(this.save.last !== today) { this.save.streak++; this.save.last = today; }
        
        document.getElementById('loot-box').innerHTML = "üíé";
        document.getElementById('win-details').classList.remove('hidden');
        document.getElementById('loot-msg').innerText = `RECOVERED: ${earned} CRYSTALS`;
        
        localStorage.setItem('metroid_brush_ultra', JSON.stringify(this.save));
        this.updateHUD();
    },

    updateHUD() {
        document.getElementById('ui-streak').innerText = this.save.streak;
        document.getElementById('ui-cry').innerText = this.save.cry;
    },
    
    showParent() { /* Add Parental PIN logic here */ }
};
</script>

</body>
</html>
