<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>TITAN OMEGA v3</title>

<style>
:root{
 --bg:#050505;
 --gold:#ffd700;
 --cyan:#00ffff;
 --purple:#bc42f5;
 --red:#ff4545;
 --panel:#111;
}

body{
 margin:0;
 background:var(--bg);
 color:#fff;
 font-family:'Courier New',monospace;
 overflow:hidden;
 height:100vh;
}

#app{
 display:flex;
 flex-direction:column;
 height:100vh;
 max-width:430px;
 margin:0 auto;
}

#header{
 height:100px;
 background:var(--panel);
 display:flex;
 flex-direction:column;
 align-items:center;
 justify-content:center;
 border-bottom:3px solid #222;
}

#title{
 font-size:16px;
 letter-spacing:3px;
 color:var(--gold);
}

#timer{
 font-size:46px;
 font-weight:900;
}

#viewport{
 flex:1;
 position:relative;
 background:#000;
}

canvas{
 width:100%;
 height:100%;
 image-rendering:pixelated;
}

#hp-wrap{
 position:absolute;
 top:15px;
 left:10%;
 width:80%;
 height:18px;
 border:2px solid #fff;
 background:#200;
}

#hp{
 height:100%;
 width:100%;
 background:linear-gradient(90deg,var(--red),#ffaa00);
}

#footer{
 height:120px;
 background:var(--panel);
 display:flex;
 justify-content:space-around;
 align-items:center;
 border-top:3px solid #222;
}

.stat{
 text-align:center;
}

.stat span{
 display:block;
 font-size:24px;
 color:var(--gold);
 font-weight:bold;
}

button{
 padding:14px 24px;
 font-weight:bold;
 background:var(--cyan);
 border:none;
 border-radius:6px;
}

#overlay{
 position:absolute;
 inset:0;
 background:#000;
 display:flex;
 flex-direction:column;
 align-items:center;
 justify-content:center;
 z-index:10;
}

#reward{
 position:absolute;
 inset:0;
 background:#000;
 display:none;
 flex-direction:column;
 align-items:center;
 justify-content:center;
 z-index:20;
}
</style>
</head>

<body>
<div id="app">

<div id="header">
<div id="title">TITAN OMEGA: CHRONO-SYNC</div>
<div id="timer">02:00</div>
</div>

<div id="viewport">
<div id="hp-wrap"><div id="hp"></div></div>
<canvas id="game"></canvas>

<div id="overlay">
<input id="name" placeholder="PILOT NAME" style="padding:10px;margin-bottom:20px;">
<button id="startBtn">ENGAGE</button>
</div>

<div id="reward">
<h1>MISSION COMPLETE</h1>
<h2 id="rewardText"></h2>
<button onclick="location.reload()">SYNC & EXIT</button>
</div>
</div>

<div id="footer">
<div class="stat">PILOT<span id="uiPilot">---</span></div>
<div class="stat">STREAK<span id="uiStreak">0</span></div>
<div class="stat">CRYSTALS<span id="uiCrystals">0</span></div>
</div>

</div>

<script>
/* ================================
   CONFIG
================================ */

const CONFIG={
 duration:120,
 bossHP:1000,
 laserDamage:8,
 overdriveThreshold:30,
 reward:100,
 limits:{stars:60,particles:120,lasers:40}
};

/* ================================
   STATE
================================ */

const state={
 active:false,
 time:CONFIG.duration,
 boss:CONFIG.bossHP,
 stars:[],
 lasers:[],
 particles:[],
 overdrive:false,
 crystals:parseInt(localStorage.getItem("tooth_crystals"))||0,
 streak:parseInt(localStorage.getItem("tooth_streak"))||0
};

/* ================================
   CANVAS
================================ */

const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d",{alpha:false});
canvas.width=430;
canvas.height=932;

/* ================================
   INIT
================================ */

function initStars(){
 state.stars=[];
 for(let i=0;i<CONFIG.limits.stars;i++){
  state.stars.push({
   x:Math.random()*430,
   y:Math.random()*932,
   v:2+Math.random()*4,
   o:Math.random()
  });
 }
}

initStars();

/* ================================
   LOOP
================================ */

let last=0;

function loop(now){
 const dt=(now-last)/1000;
 last=now;

 if(state.active){
  update(dt);
  render();
 }

 requestAnimationFrame(loop);
}

requestAnimationFrame(loop);

/* ================================
   UPDATE
================================ */

function update(dt){

 state.time-=dt;
 if(state.time<=0){victory();return;}

 if(state.time<=CONFIG.overdriveThreshold)
  state.overdrive=true;

 autoFire();

 moveLasers(dt);
 moveParticles(dt);
 updateUI();
}

function autoFire(){
 if(state.lasers.length>=CONFIG.limits.lasers) return;

 state.lasers.push({
  x:215,
  y:700,
  vy:-500
 });
}

function moveLasers(dt){
 for(let i=state.lasers.length-1;i>=0;i--){
  const l=state.lasers[i];
  l.y+=l.vy*dt;

  if(l.y<200){
   state.boss-=CONFIG.laserDamage;
   spawnImpact(l.x,l.y);
   state.lasers.splice(i,1);
  }

  if(l.y<0) state.lasers.splice(i,1);
 }
}

function spawnImpact(x,y){
 for(let i=0;i<5;i++){
  if(state.particles.length>=CONFIG.limits.particles) return;
  state.particles.push({
   x,y,
   vx:(Math.random()-0.5)*200,
   vy:(Math.random()-0.5)*200,
   life:1
  });
 }
}

function moveParticles(dt){
 for(let i=state.particles.length-1;i>=0;i--){
  const p=state.particles[i];
  p.x+=p.vx*dt;
  p.y+=p.vy*dt;
  p.life-=dt;
  if(p.life<=0) state.particles.splice(i,1);
 }
}

function victory(){
 state.active=false;
 state.crystals+=CONFIG.reward;
 state.streak+=1;
 localStorage.setItem("tooth_crystals",state.crystals);
 localStorage.setItem("tooth_streak",state.streak);

 document.getElementById("rewardText").innerText=
 "+"+CONFIG.reward+" CRYSTALS";

 document.getElementById("reward").style.display="flex";
}

/* ================================
   RENDER
================================ */

function render(){
 ctx.fillStyle="#000";
 ctx.fillRect(0,0,430,932);

 state.stars.forEach(s=>{
  s.y+=s.v*(state.overdrive?3:1);
  if(s.y>932) s.y=0;
  ctx.fillStyle="rgba(255,255,255,"+s.o+")";
  ctx.fillRect(s.x,s.y,2,2);
 });

 ctx.fillStyle=state.overdrive?"#ff0000":"#555";
 ctx.fillRect(150,150,130,130);

 ctx.fillStyle="#00ffff";
 state.lasers.forEach(l=>{
  ctx.fillRect(l.x,l.y,4,20);
 });

 state.particles.forEach(p=>{
  ctx.globalAlpha=p.life;
  ctx.fillStyle="#ffd700";
  ctx.fillRect(p.x,p.y,4,4);
 });
 ctx.globalAlpha=1;
}

/* ================================
   UI
================================ */

function updateUI(){
 const m=Math.floor(state.time/60);
 const s=Math.floor(state.time%60);
 document.getElementById("timer").innerText=
  String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");

 document.getElementById("hp").style.width=
  (state.boss/CONFIG.bossHP)*100+"%";

 document.getElementById("uiCrystals").innerText=state.crystals;
 document.getElementById("uiStreak").innerText=state.streak;
}

/* ================================
   START
================================ */

document.getElementById("startBtn").onclick=()=>{
 const name=document.getElementById("name").value||"PILOT";
 document.getElementById("uiPilot").innerText=name.toUpperCase();
 document.getElementById("overlay").style.display="none";
 state.active=true;
};
</script>
</body>
</html>
