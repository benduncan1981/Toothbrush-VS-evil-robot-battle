<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Starship Brush Pilot</title>
    <style>
        :root {
            --glow: #00f2ff;
            --bg: #05050a;
            --panel: rgba(20, 25, 40, 0.9);
            --font-main: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: var(--bg); color: white;
            font-family: var(--font-main); overflow: hidden;
            user-select: none; -webkit-user-select: none;
        }

        /* Space Background */
        #space-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        }

        /* Cockpit HUD Overlay */
        #hud {
            display: flex; flex-direction: column; align-items: center;
            justify-content: space-between; height: 100vh; padding: 20px;
            box-sizing: border-box;
            background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.4) 100%);
        }

        /* Top Bar: Progress Segments */
        .progress-container {
            display: flex; gap: 10px; width: 90%; max-width: 500px; margin-top: 20px;
        }
        .segment {
            flex: 1; height: 12px; background: rgba(255,255,255,0.1);
            border: 1px solid var(--glow); border-radius: 4px; overflow: hidden;
        }
        .segment-fill {
            height: 100%; width: 0%; background: var(--glow);
            box-shadow: 0 0 10px var(--glow); transition: width 0.3s linear;
        }

        /* Center: The Big Timer */
        #timer-display {
            font-size: 5rem; font-weight: bold; font-family: monospace;
            text-shadow: 0 0 20px var(--glow); letter-spacing: 5px;
        }

        /* Bottom: Action Zone */
        .controls { margin-bottom: 40px; text-align: center; }
        button {
            background: var(--panel); color: var(--glow);
            border: 2px solid var(--glow); padding: 20px 40px;
            font-size: 1.5rem; border-radius: 50px; cursor: pointer;
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.3);
            text-transform: uppercase; letter-spacing: 2px;
        }
        button:active { transform: scale(0.95); background: var(--glow); color: var(--bg); }

        /* Stats */
        .stats { position: absolute; bottom: 20px; left: 20px; font-size: 0.9rem; opacity: 0.7; }
        
        /* Hidden UI for Settings */
        #parent-gate { position: absolute; top: 10px; right: 10px; width: 40px; height: 40px; opacity: 0.2; }

        /* Victory Screen */
        #victory {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 10;
            flex-direction: column; align-items: center; justify-content: center;
            text-align: center;
        }
        .crystal-icon { font-size: 4rem; margin-bottom: 10px; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<canvas id="space-canvas"></canvas>

<div id="hud">
    <div id="parent-gate" oncontextmenu="return false;"></div>
    
    <div class="progress-container">
        <div class="segment"><div id="seg-1" class="segment-fill"></div></div>
        <div class="segment"><div id="seg-2" class="segment-fill"></div></div>
        <div class="segment"><div id="seg-3" class="segment-fill"></div></div>
        <div class="segment"><div id="seg-4" class="segment-fill"></div></div>
    </div>

    <div id="timer-display">02:00</div>

    <div class="controls">
        <button id="start-btn">Launch Mission</button>
    </div>

    <div class="stats">
        STREAK: <span id="streak-count">0</span> | CRYSTALS: <span id="crystal-count">0</span>
    </div>
</div>

<div id="victory">
    <div class="crystal-icon">ðŸ’Ž</div>
    <h1 style="color: var(--glow);">MISSION COMPLETE!</h1>
    <p>+4 Crystals Awarded</p>
    <button onclick="location.reload()">Return to Hangar</button>
</div>

<script>
    // --- APP STATE ---
    let totalSeconds = 120;
    let timeLeft = totalSeconds;
    let isRunning = false;
    let timerInterval;
    let crystals = parseInt(localStorage.getItem('crystals')) || 0;
    let streak = parseInt(localStorage.getItem('streak')) || 0;

    const display = document.getElementById('timer-display');
    const startBtn = document.getElementById('start-btn');
    const crystalEl = document.getElementById('crystal-count');
    const streakEl = document.getElementById('streak-count');

    crystalEl.innerText = crystals;
    streakEl.innerText = streak;

    // --- AUDIO ENGINE (Web Audio API - Safe & Local) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTone(freq, type, duration) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    // --- STARFIELD ANIMATION ---
    const canvas = document.getElementById('space-canvas');
    const ctx = canvas.getContext('2d');
    let stars = [];

    function initStars() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        stars = [];
        for (let i = 0; i < 200; i++) {
            stars.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, size: Math.random() * 2, speed: Math.random() * 0.5 });
        }
    }

    function animateStars() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        stars.forEach(s => {
            ctx.beginPath();
            ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
            ctx.fill();
            s.y += isRunning ? s.speed * 5 : s.speed; // Speed up when brushing
            if (s.y > canvas.height) s.y = 0;
        });
        requestAnimationFrame(animateStars);
    }

    // --- TIMER LOGIC ---
    function updateDisplay() {
        const m = Math.floor(timeLeft / 60);
        const s = timeLeft % 60;
        display.innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        
        // Update Segments (4 quadrants of 30s)
        for (let i = 1; i <= 4; i++) {
            const segThreshold = totalSeconds - (i * 30);
            const fill = document.getElementById(`seg-${i}`);
            if (timeLeft <= segThreshold) {
                fill.style.width = "100%";
            } else if (timeLeft < (totalSeconds - (i-1)*30)) {
                let segmentProgress = ((totalSeconds - (i-1)*30) - timeLeft) / 30 * 100;
                fill.style.width = segmentProgress + "%";
            }
        }
    }

    function startMission() {
        if (isRunning) return;
        isRunning = true;
        startBtn.classList.add('hidden');
        audioCtx.resume();
        playTone(440, 'square', 0.2);

        timerInterval = setInterval(() => {
            timeLeft--;
            updateDisplay();

            // Periodic Audio Feedback
            if (timeLeft % 30 === 0 && timeLeft > 0) {
                playTone(880, 'sine', 0.5); // "Micro-goal" chime
                crystals += 1;
                crystalEl.innerText = crystals;
                localStorage.setItem('crystals', crystals);
            }

            if (timeLeft <= 0) {
                completeMission();
            }
        }, 1000);
    }

    function completeMission() {
        clearInterval(timerInterval);
        isRunning = false;
        playTone(1200, 'sine', 1);
        
        // Final Rewards
        crystals += 1; // Last segment crystal
        streak += 1;
        localStorage.setItem('crystals', crystals);
        localStorage.setItem('streak', streak);
        
        document.getElementById('victory').style.display = 'flex';
    }

    // --- INITIALIZE ---
    window.addEventListener('resize', initStars);
    startBtn.addEventListener('click', startMission);
    initStars();
    animateStars();

    // Parental Gate (Simple long-press on invisible area to reset)
    let gateTimer;
    document.getElementById('parent-gate').addEventListener('mousedown', () => {
        gateTimer = setTimeout(() => {
            if(confirm("Parent: Reset all stats?")) {
                localStorage.clear();
                location.reload();
            }
        }, 3000);
    });
    document.getElementById('parent-gate').addEventListener('mouseup', () => clearTimeout(gateTimer));

</script>
</body>
</html>
