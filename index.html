<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tooth Runner 2084</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{width:100%;height:100%;background:#000;color:#fff;font-family:'Press Start 2P',system-ui,monospace;overflow:hidden}
    body{display:flex;justify-content:center;align-items:stretch}
    #app{width:100%;max-width:480px;padding:8px;display:flex;flex-direction:column}
    #titleBar{text-align:center;margin-bottom:6px}
    #gameTitle{font-size:16px;color:#44ffcc;text-shadow:0 0 6px #44ffcc}
    #subtitle{font-size:8px;opacity:.8}
    #hud{display:flex;justify-content:space-between;align-items:center;margin:6px 0;font-size:8px}
    #timerDisplay{font-size:20px;color:#ffff66;text-shadow:0 0 6px #ffff66}
    #zoneDisplay{font-size:8px;margin-top:4px;opacity:.9}
    #progressBarOuter{width:100%;height:12px;border:2px solid #44ffcc;background:#111;margin-bottom:6px;position:relative}
    #progressBarInner{width:0;height:100%;background:linear-gradient(90deg,#44ff44,#ffff00);transition:width .2s linear}
    #gameContainer{position:relative;width:100%;flex:1 1 auto;border:3px solid #44ffcc;background:#000;overflow:hidden;display:flex;justify-content:center;align-items:center;min-height:0}
    #gameCanvas{image-rendering:pixelated;display:block}
    #crtOverlay{pointer-events:none;position:absolute;inset:0;background:repeating-linear-gradient(to bottom,rgba(255,255,255,.05),rgba(255,255,255,.05) 1px,rgba(0,0,0,0) 2px);mix-blend-mode:soft-light;opacity:.25}
    #bottomHint{margin-top:4px;font-size:7px;text-align:center;opacity:.8}
    #parentBar{margin-top:6px;font-size:7px;text-align:right;opacity:.6}
    #parentBar button{font-size:7px;padding:4px 6px;background:#333;color:#fff;border:none;border-radius:3px;cursor:pointer}
    #startOverlay,#lootOverlay{position:fixed;inset:0;background:rgba(0,0,0,.92);display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:20px;z-index:20}
    #lootOverlay{display:none;z-index:30}
    #startOverlay h1{font-size:20px;margin-bottom:12px;color:#44ffcc;text-shadow:0 0 6px #44ffcc}
    #startMissionText{font-size:10px;line-height:1.6;margin-bottom:16px;white-space:pre-line;opacity:.9}
    #startButton,#lootOkButton{font-size:12px;padding:12px 20px;background:#44ffcc;color:#000;border:none;border-radius:6px;cursor:pointer;box-shadow:0 0 10px #44ffcc}
    #startButton:active,#lootOkButton:active{transform:translateY(2px)}
    #lootTitle{font-size:18px;margin-bottom:12px;color:#ffcc00;text-shadow:0 0 6px #ffcc00}
    #lootBox{width:140px;height:140px;background:linear-gradient(135deg,#ffcc00,#ff6600);border-radius:10px;box-shadow:0 0 0 4px #fff,0 0 20px #ffcc00;display:flex;justify-content:center;align-items:center;margin-bottom:12px;cursor:pointer;position:relative}
    #lootBox::before{content:'';position:absolute;width:80%;height:10px;background:rgba(0,0,0,.3);top:50%;left:10%;transform:translateY(-50%)}
    #lootBoxLabel{font-size:12px;z-index:2}
    #lootResult{font-size:10px;white-space:pre-line;margin-bottom:12px}
    .lootPulse{animation:lootPulse .7s ease-in-out infinite}
    @keyframes lootPulse{0%,100%{transform:scale(1);box-shadow:0 0 0 4px #fff,0 0 20px #ffcc00}50%{transform:scale(1.08);box-shadow:0 0 0 4px #fff,0 0 30px #ffff66}}
    #parentPanel{position:fixed;right:4px;bottom:4px;width:260px;max-width:90%;background:rgba(0,0,0,.95);border:2px solid #444;padding:10px;font-size:7px;display:none;z-index:40}
    #parentPanelHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    #parentPanelHeader span{font-size:9px}
    #parentCloseButton{font-size:8px;padding:2px 4px;background:#333;color:#fff;border:none;cursor:pointer}
    #parentContent label{display:block;margin-top:6px;margin-bottom:2px}
    #parentContent input{width:100%;font-size:8px;padding:3px;background:#111;color:#fff;border:1px solid #444;margin-bottom:4px}
    #parentContent button{font-size:8px;padding:4px 6px;background:#444;color:#fff;border:none;border-radius:3px;margin-right:4px;cursor:pointer}
    .flash{animation:flashAnim .2s linear 3}
    @keyframes flashAnim{0%,100%{background:#000}50%{background:#441111}}
    .screenShake{animation:shakeAnim .4s linear 1}
    @keyframes shakeAnim{0%{transform:translate(0,0)}25%{transform:translate(-3px,2px)}50%{transform:translate(3px,-2px)}75%{transform:translate(-2px,-3px)}100%{transform:translate(0,0)}}
    @media(max-height:700px){#gameTitle{font-size:14px}#subtitle{font-size:7px}#timerDisplay{font-size:16px}#bottomHint{font-size:6px}}
    @media(min-height:900px){#gameContainer{border-width:4px}#progressBarOuter{height:14px}#timerDisplay{font-size:22px}}
  </style>
</head>
<body>
  <div id="startOverlay">
    <h1>TOOTH RUNNER 2084</h1>
    <p id="startMissionText">
MISSION: REBUILD TOOTH CITY

5 SECOND COUNTDOWN • 2 MINUTE RUN • AUTO‑PLAY
    </p>
    <button id="startButton">START MISSION</button>
  </div>

  <div id="lootOverlay">
    <h2 id="lootTitle">MISSION COMPLETE!</h2>
    <div id="lootBox" class="lootPulse">
      <span id="lootBoxLabel">TAP TO OPEN</span>
    </div>
    <div id="lootResult"></div>
    <button id="lootOkButton">OK</button>
  </div>

  <div id="parentPanel">
    <div id="parentPanelHeader">
      <span>Parent Controls</span>
      <button id="parentCloseButton">X</button>
    </div>
    <div id="parentContent">
      <label for="parentPass">Passcode (1202):</label>
      <input type="password" id="parentPass">
      <label for="parentStreak">Streak:</label>
      <input type="number" id="parentStreak" min="0">
      <label for="parentDays">Days Played:</label>
      <input type="number" id="parentDays" min="0">
      <label for="parentCrystals">Crystals:</label>
      <input type="number" id="parentCrystals" min="0">
      <button id="parentApplyButton">Apply</button>
      <button id="parentResetButton">Reset All</button>
      <small>Values are stored locally on this device only.</small>
    </div>
  </div>

  <div id="app">
    <header id="titleBar">
      <div id="gameTitle">TOOTH RUNNER 2084</div>
      <div id="subtitle">BRUSH • RUN • LOOT • BUILD TOOTH CITY</div>
    </header>

    <section id="hud">
      <div id="hudLeft">
        <div id="streakDisplay">STREAK: 0</div>
        <div id="daysDisplay">DAYS: 0</div>
      </div>
      <div id="hudCenter">
        <div id="timerDisplay">2:00</div>
        <div id="zoneDisplay">ZONE 1 • ENAMEL DISTRICT</div>
      </div>
      <div id="hudRight">
        <div id="crystalDisplay">CRYSTALS: 0</div>
        <div id="skinDisplay">SKIN: DEFAULT</div>
      </div>
    </section>

    <section id="progressBarSection">
      <div id="progressBarOuter">
        <div id="progressBarInner"></div>
      </div>
    </section>

    <main id="gameContainer">
      <canvas id="gameCanvas" width="320" height="480"></canvas>
      <div id="crtOverlay"></div>
    </main>

    <footer id="bottomHint">
      WATCH THE RUN WHILE YOU BRUSH • LOOT BOX AFTER EACH MISSION
    </footer>

    <div id="parentBar">
      <span>Parent controls</span>
      <button id="parentOpenButton">OPEN</button>
    </div>
  </div>

  <script>
    const startOverlay=document.getElementById('startOverlay');
    const startButton=document.getElementById('startButton');
    const lootOverlay=document.getElementById('lootOverlay');
    const lootBox=document.getElementById('lootBox');
    const lootBoxLabel=document.getElementById('lootBoxLabel');
    const lootResult=document.getElementById('lootResult');
    const lootOkButton=document.getElementById('lootOkButton');
    const parentPanel=document.getElementById('parentPanel');
    const parentOpenButton=document.getElementById('parentOpenButton');
    const parentCloseButton=document.getElementById('parentCloseButton');
    const parentPassInput=document.getElementById('parentPass');
    const parentStreakInput=document.getElementById('parentStreak');
    const parentDaysInput=document.getElementById('parentDays');
    const parentCrystalsInput=document.getElementById('parentCrystals');
    const parentApplyButton=document.getElementById('parentApplyButton');
    const parentResetButton=document.getElementById('parentResetButton');
    const timerDisplay=document.getElementById('timerDisplay');
    const zoneDisplay=document.getElementById('zoneDisplay');
    const streakDisplay=document.getElementById('streakDisplay');
    const daysDisplay=document.getElementById('daysDisplay');
    const crystalDisplay=document.getElementById('crystalDisplay');
    const skinDisplay=document.getElementById('skinDisplay');
    const progressBarInner=document.getElementById('progressBarInner');
    const gameContainer=document.getElementById('gameContainer');
    const canvas=document.getElementById('gameCanvas');
    const ctx=canvas.getContext('2d');

    const RUN_DURATION=120;
    const PRE_COUNTDOWN=5;
    const ZONE_LENGTH=30;
    const FPS=60;
    const DT=1/FPS;

    let state={
      inPre:false,inRun:false,inLoot:false,
      preTime:PRE_COUNTDOWN,timeLeft:RUN_DURATION,
      zone:1,lastTs:0,acc:0,
      score:0,streak:0,days:0,crystals:0,skin:'DEFAULT',
      lootThisRun:0
    };

    let hero={x:60,y:320,w:24,h:24,vy:0,onGround:true,anim:0,animT:0};
    let groundY=360;
    let scrollX=0;
    let obstacles=[];
    let particles=[];

    function formatTime(sec){
      const m=Math.floor(sec/60);
      const s=sec%60;
      return m+':'+(s<10?'0'+s:s);
    }
    function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

    function loadProgress(){
      state.streak=parseInt(localStorage.getItem('tr_streak')||'0',10);
      state.days=parseInt(localStorage.getItem('tr_days')||'0',10);
      state.crystals=parseInt(localStorage.getItem('tr_crystals')||'0',10);
    }
    function saveProgress(){
      localStorage.setItem('tr_streak',state.streak);
      localStorage.setItem('tr_days',state.days);
      localStorage.setItem('tr_crystals',state.crystals);
    }

    function updateHUD(){
      timerDisplay.textContent=formatTime(Math.max(0,Math.floor(state.timeLeft)));
      streakDisplay.textContent='STREAK: '+state.streak;
      daysDisplay.textContent='DAYS: '+state.days;
      crystalDisplay.textContent='CRYSTALS: '+state.crystals;
      skinDisplay.textContent='SKIN: '+state.skin;
      zoneDisplay.textContent=
        'ZONE '+state.zone+' • '+
        (state.zone===1?'ENAMEL DISTRICT':
         state.zone===2?'FLOSS HIGHWAY':
         state.zone===3?'GUMLINE FORGE':
         'CAVITY CORE');
    }
    function updateProgressBar(){
      const elapsed=RUN_DURATION-state.timeLeft;
      const r=clamp(elapsed/RUN_DURATION,0,1);
      progressBarInner.style.width=(r*100)+'%';
    }

    function setZone(z){
      state.zone=z;
      gameContainer.classList.remove('zone1-bg','zone2-bg','zone3-bg','zone4-bg');
      gameContainer.classList.add('zone'+z+'-bg');
      gameContainer.classList.add('flash');
      setTimeout(()=>gameContainer.classList.remove('flash'),250);
    }

    function resetWorld(){
      hero.x=60;hero.y=groundY-hero.h;
      hero.vy=0;hero.onGround=true;
      hero.anim=0;hero.animT=0;
      scrollX=0;obstacles=[];particles=[];
    }

    function spawnObstacle(){
      const gap=80+Math.random()*80;
      const w=20+Math.random()*20;
      obstacles.push({
        x:canvas.width+gap,
        y:groundY-16,
        w:w,h:16,
        type:Math.random()<0.2?'tooth':'block'
      });
    }

    function addParticles(x,y,color,count=8){
      for(let i=0;i<count;i++){
        particles.push({
          x,y,
          vx:(Math.random()-0.5)*80,
          vy:(Math.random()-0.5)*80,
          life:0.4+Math.random()*0.3,
          color
        });
      }
    }

    function startPre(){
      state.inPre=true;state.inRun=false;state.inLoot=false;
      state.preTime=PRE_COUNTDOWN;
      timerDisplay.textContent='0:0'+PRE_COUNTDOWN;
    }

    function startRun(){
      state.inPre=false;state.inRun=true;state.inLoot=false;
      state.timeLeft=RUN_DURATION;
      state.zone=1;state.score=0;state.lootThisRun=0;
      setZone(1);resetWorld();updateHUD();updateProgressBar();
    }

    function endRun(){
      if(state.inLoot)return;
      state.inRun=false;state.inLoot=true;
      const base=10;
      const scoreBonus=Math.floor(state.score/50);
      const streakBonus=Math.floor(state.streak/2);
      const reward=base+scoreBonus+streakBonus;
      state.crystals+=reward;
      state.days+=1;
      state.streak+=1;
      state.lootThisRun=reward;
      saveProgress();updateHUD();
      lootOverlay.style.display='flex';
      lootBoxLabel.textContent='TAP TO OPEN';
      lootResult.textContent='';
      lootBox.classList.add('lootPulse');
    }

    function update(dt){
      if(state.inPre){
        state.preTime-=dt;
        if(state.preTime<=0){startRun();}
        else{
          const s=Math.ceil(state.preTime);
          timerDisplay.textContent='0:0'+s;
        }
        return;
      }
      if(!state.inRun)return;

      state.timeLeft-=dt;
      if(state.timeLeft<=0){
        state.timeLeft=0;
        updateHUD();updateProgressBar();
        endRun();return;
      }

      const prevZone=state.zone;
      const elapsed=RUN_DURATION-state.timeLeft;
      const newZone=Math.floor(elapsed/ZONE_LENGTH)+1;
      if(newZone!==prevZone && newZone>=1 && newZone<=4){setZone(newZone);}

      if(Math.floor(state.timeLeft)!==Math.floor(state.timeLeft+dt)){
        updateHUD();updateProgressBar();
      }

      const speed=140;
      scrollX+=speed*dt;

      hero.animT+=dt;
      if(hero.animT>0.15){hero.animT=0;hero.anim=(hero.anim+1)%2;}

      hero.vy+=600*dt;
      hero.y+=hero.vy*dt;
      if(hero.y+hero.h>=groundY){
        hero.y=groundY-hero.h;
        hero.vy=0;hero.onGround=true;
      }

      if(Math.random()<0.02)spawnObstacle();

      for(let o of obstacles){o.x-=speed*dt;}
      obstacles=obstacles.filter(o=>o.x+o.w>-20);

      for(let o of obstacles){
        if(o.x<hero.x+hero.w &&
           o.x+o.w>hero.x &&
           o.y<hero.y+hero.h &&
           o.y+o.h>hero.y){
          addParticles(hero.x+hero.w/2,hero.y+hero.h/2,'#ff6666',12);
          state.streak=0;
          state.score=Math.max(0,state.score-50);
          updateHUD();
        }
      }

      for(let p of particles){
        p.life-=dt;p.x+=p.vx*dt;p.y+=p.vy*dt;
      }
      particles=particles.filter(p=>p.life>0);

      state.score+=Math.floor(20*dt);
    }

    function render(){
      ctx.fillStyle='#000';
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.fillStyle='#111';
      for(let x=-(scrollX%40);x<canvas.width;x+=40){
        ctx.fillRect(x,groundY,40,4);
      }

      ctx.fillStyle='#222';
      for(let x=-(scrollX*0.5%80);x<canvas.width;x+=80){
        ctx.fillRect(x,groundY-40,40,20);
      }

      ctx.fillStyle='#00ccff';
      ctx.fillRect(hero.x,hero.y,hero.w,hero.h);
      ctx.fillStyle='#ffffff';
      ctx.fillRect(hero.x+4,hero.y+4,8,4);
      ctx.fillStyle='#000000';
      ctx.fillRect(hero.x+5,hero.y+5,3,2);
      ctx.fillStyle='#ffff00';
      ctx.fillRect(hero.x+hero.w-4,hero.y+10,6,4);

      ctx.fillStyle='#ff8844';
      for(let o of obstacles){
        ctx.fillRect(o.x,o.y,o.w,o.h);
        if(o.type==='tooth'){
          ctx.fillStyle='#ffffff';
          ctx.fillRect(o.x+2,o.y-6,o.w-4,6);
          ctx.fillStyle='#ff8844';
        }
      }

      for(let p of particles){
        ctx.fillStyle=p.color;
        ctx.fillRect(p.x,p.y,2,2);
      }
    }

    function loop(ts){
      if(!state.lastTs)state.lastTs=ts;
      let delta=(ts-state.lastTs)/1000;
      state.lastTs=ts;
      if(delta>0.05)delta=0.05;
      state.acc+=delta;
      while(state.acc>=DT){
        update(DT);
        state.acc-=DT;
      }
      render();
      requestAnimationFrame(loop);
    }

    function resizeCanvas(){
      const titleH=document.getElementById('titleBar').offsetHeight;
      const hudH=document.getElementById('hud').offsetHeight;
      const progH=document.getElementById('progressBarSection').offsetHeight;
      const bottomH=document.getElementById('bottomHint').offsetHeight;
      const parentH=document.getElementById('parentBar').offsetHeight;
      const uiH=titleH+hudH+progH+bottomH+parentH+20;
      const vh=window.innerHeight;
      const avail=vh-uiH;
      const baseW=320,baseH=480;
      const scale=Math.max(0.5,avail/baseH);
      canvas.width=baseW;canvas.height=baseH;
      canvas.style.width=(baseW*scale)+'px';
      canvas.style.height=(baseH*scale)+'px';
    }

    startButton.addEventListener('click',()=>{
      startOverlay.style.display='none';
      startPre();
    });

    lootBox.addEventListener('click',()=>{
      if(!state.inLoot)return;
      lootBoxLabel.textContent='OPENED!';
      lootBox.classList.remove('lootPulse');
      lootResult.textContent=
        'CRYSTALS THIS RUN: '+state.lootThisRun+
        '\nTOTAL CRYSTALS: '+state.crystals+
        '\nSTREAK: '+state.streak+
        '\nDAYS: '+state.days;
    });

    lootOkButton.addEventListener('click',()=>{
      lootOverlay.style.display='none';
      startOverlay.style.display='flex';
      state.inLoot=false;
    });

    parentOpenButton.addEventListener('click',()=>{
      parentPanel.style.display='block';
      parentPassInput.value='';
      parentStreakInput.value=state.streak;
      parentDaysInput.value=state.days;
      parentCrystalsInput.value=state.crystals;
    });
    parentCloseButton.addEventListener('click',()=>{parentPanel.style.display='none';});
    parentApplyButton.addEventListener('click',()=>{
      if(parentPassInput.value!=='1202'){alert('Incorrect passcode');return;}
      state.streak=parseInt(parentStreakInput.value||'0',10);
      state.days=parseInt(parentDaysInput.value||'0',10);
      state.crystals=parseInt(parentCrystalsInput.value||'0',10);
      saveProgress();updateHUD();
      parentPanel.style.display='none';
    });
    parentResetButton.addEventListener('click',()=>{
      if(parentPassInput.value!=='1202'){alert('Incorrect passcode');return;}
      if(!confirm('Reset all progress?'))return;
      state.streak=0;state.days=0;state.crystals=0;
      saveProgress();updateHUD();
      parentPanel.style.display='none';
    });

    window.addEventListener('resize',()=>{resizeCanvas();render();});
    window.addEventListener('orientationchange',()=>{setTimeout(()=>{resizeCanvas();render();},300);});

    loadProgress();
    updateHUD();
    updateProgressBar();
    resizeCanvas();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
