<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEURAL-LINK: TITAN OMEGA</title>
    <style>
        :root { --gba-bg: #081820; --cyan: #00ffff; --gold: #fcc201; --red: #ff4545; }
        body, html { margin: 0; padding: 0; background: #000; overflow: hidden; height: 100vh; font-family: 'Courier New', monospace; color: white; }
        
        #game-frame { position: relative; width: 100vw; height: 100vh; max-width: 430px; margin: 0 auto; background: #111; border: 4px solid #444; box-shadow: inset 0 0 20px #000; overflow: hidden; }
        canvas { display: block; image-rendering: pixelated; width: 100%; height: 100%; }

        /* Star Wars Intro Text */
        #intro-scene { position: absolute; inset: 0; background: black; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        #crawl-container { position: relative; width: 80%; transform: perspective(200px) rotateX(25deg); }
        #crawl-text { position: absolute; top: 100%; font-size: 24px; color: var(--gold); text-align: justify; animation: crawl 20s linear forwards; }
        @keyframes crawl { 0% { top: 100%; } 100% { top: -150%; } }

        /* UI Overlays */
        .hud-panel { position: absolute; top: 10px; left: 10px; pointer-events: none; z-index: 50; }
        .controls { position: absolute; top: 10px; right: 10px; display: flex; gap: 10px; z-index: 50; }
        .btn-ui { background: #333; border: 2px solid #666; color: white; padding: 8px; font-size: 12px; cursor: pointer; text-transform: uppercase; }
        
        #name-entry { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 110; }
        input { background: #000; border: 2px solid var(--cyan); color: var(--cyan); padding: 10px; font-size: 20px; text-align: center; margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="game-frame">
    <canvas id="stage"></canvas>
    
    <!-- HUD Layer -->
    <div class="hud-panel">
        <div id="hud-name">PILOT: UNKNOWN</div>
        <div style="color: var(--gold)">CRYSTALS: <span id="hud-cry">0</span></div>
        <div style="color: var(--cyan)">STREAK: <span id="hud-str">0</span> DAYS</div>
    </div>

    <div class="controls">
        <button class="btn-ui" onclick="togglePause()">Pause</button>
        <button class="btn-ui" onclick="location.reload()">Reset</button>
    </div>

    <!-- Name Entry Screen -->
    <div id="name-entry">
        <h2>IDENTIFY PILOT</h2>
        <input type="text" id="p-name" placeholder="ENTER NAME" maxlength="10">
        <button class="btn-ui" style="font-size: 20px;" onclick="saveName()">SYNC NEURAL LINK</button>
    </div>

    <!-- Intro Scene -->
    <div id="intro-scene" style="display:none">
        <div id="crawl-container">
            <div id="crawl-text">
                The year is 2099. The RUINED TITAN has infected the galaxy with plaque-bots. 
                Only one pilot remains... Equipped with the OMEGA BRUSH, you must 
                fly into the burning core of the machine world and scrub away 
                the darkness. Brushing for 120 seconds will trigger the Neural-Link 
                Explosion. Good luck, Pilot. The galaxy is counting on your smile...
            </div>
        </div>
        <button class="btn-ui" style="position:absolute; bottom:40px;" onclick="startGame()">SKIP TO BATTLE</button>
    </div>
</div>

<script>
/** 
 * PIXEL MASKS: HERO & CYBORG 
 */
const HERO_MASK = [
    "00444000", "04777400", "04717400", "44444444", "44444444", "04444400", "04404400", "04404400"
]; // Mini Mega-Man style
const BOSS_MASK = [
    "02222200", "22522522", "22222222", "02255220", "02222220", "22252222", "22222222", "02000020"
]; // Cyborg Skull style

const PAL = ['transparent', '#000', '#555', '#888', '#0055ff', '#ff0000', '#fff', '#ffcc00'];

const canvas = document.getElementById('stage');
const ctx = canvas.getContext('2d');
let pilotName = "PILOT";

// State Engine
let s = {
    active: false, paused: false, t: 120, startTime: 0,
    cry: parseInt(localStorage.getItem('gba_crystals_v1')) || 0,
    str: parseInt(localStorage.getItem('gba_streak_v1')) || 0,
    lasers: [], stars: [], f: 0
};

function saveName() {
    pilotName = document.getElementById('p-name').value || "PILOT";
    document.getElementById('hud-name').innerText = `PILOT: ${pilotName.toUpperCase()}`;
    document.getElementById('name-entry').style.display = 'none';
    document.getElementById('intro-scene').style.display = 'flex';
    updateHUD();
}

function startGame() {
    document.getElementById('intro-scene').style.display = 'none';
    canvas.width = 430; canvas.height = 932;
    // Pre-gen stars
    for(let i=0; i<50; i++) s.stars.push({x: Math.random()*430, y: Math.random()*932, z: Math.random()*5+1});
    s.active = true;
    s.startTime = Date.now();
    requestAnimationFrame(loop);
}

function updateHUD() {
    document.getElementById('hud-cry').innerText = s.cry;
    document.getElementById('hud-str').innerText = s.str;
}

function togglePause() { s.paused = !s.paused; }

function drawSprite(mask, x, y, size) {
    mask.forEach((row, ri) => {
        [...row].forEach((px, pi) => {
            const c = PAL[parseInt(px)];
            if(c !== 'transparent') {
                ctx.fillStyle = c;
                ctx.fillRect(x + pi*size, y + ri*size, size, size);
            }
        });
    });
}

function loop() {
    if(!s.active || s.paused) { requestAnimationFrame(loop); return; }

    // Accurate Timer Logic
    const elapsed = Math.floor((Date.now() - s.startTime) / 1000);
    s.t = 120 - elapsed;
    if(s.t <= 0) { finish(); return; }

    s.f++;
    ctx.fillStyle = '#081820'; ctx.fillRect(0, 0, 430, 932);

    // Space Warp (Stars)
    s.stars.forEach(st => {
        st.y += st.z * 2;
        if(st.y > 932) st.y = -10;
        ctx.fillStyle = `rgba(255,255,255,${st.z/5})`;
        ctx.fillRect(st.x, st.y, 2, 2);
    });

    // Boss (Cyborg Robot)
    const stage = Math.min(3, Math.floor((120-s.t)/30));
    const bx = 160 + Math.sin(s.f*0.05)*40;
    const by = 200 + Math.cos(s.f*0.02)*20;
    drawSprite(BOSS_MASK, bx, by, 14);
    
    // Boss Damage FX
    if(stage > 1 && s.f % 10 === 0) {
        ctx.fillStyle = s.f%20===0 ? "white" : "red";
        ctx.fillRect(bx+50, by+50, 10, 10);
    }

    // Hero (Mega Pilot)
    const hx = 180 + Math.sin(s.f*0.03)*20;
    const hy = 750;
    drawSprite(HERO_MASK, hx, hy, 10);

    // Lasers (Visual only, no collision required to keep focus)
    if(s.f % 10 === 0) {
        s.lasers.push({x: hx + 40, y: hy});
    }
    s.lasers.forEach((l, i) => {
        l.y -= 20;
        ctx.fillStyle = '#0ff';
        ctx.fillRect(l.x, l.y, 4, 20);
        ctx.shadowBlur = 10; ctx.shadowColor = "#0ff";
        if(l.y < 0) s.lasers.splice(i, 1);
    });
    ctx.shadowBlur = 0;

    // Timer & Progress
    ctx.fillStyle = "white"; ctx.font = "bold 40px Courier";
    ctx.fillText(`${s.t}s`, 180, 500);

    requestAnimationFrame(loop);
}

function finish() {
    s.active = false;
    s.cry += 100;
    s.str += 1;
    localStorage.setItem('gba_crystals_v1', s.cry);
    localStorage.setItem('gba_streak_v1', s.str);
    updateHUD();
    alert("NEURAL LINK COMPLETE! 100 CRYSTALS EARNED.");
    location.reload();
}
</script>
</body>
</html>
