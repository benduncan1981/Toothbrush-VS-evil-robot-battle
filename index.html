<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tooth Blaster 2084</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:#000;
  color:#fff;
  font-family:'Press Start 2P',system-ui,monospace;
  overflow:hidden;
}
#wrapper{
  max-width:480px;
  margin:0 auto;
  padding:8px;
  text-align:center;
}
h1{
  font-size:14px;
  margin-bottom:4px;
}
.sub{
  font-size:8px;
  opacity:0.8;
  margin-bottom:6px;
}
#hud{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:8px;
  margin-bottom:4px;
}
#timer{
  font-size:16px;
}
#score,#streak{
  font-size:8px;
}
#quadrant{
  font-size:8px;
  margin-bottom:4px;
}

/* GAME AREA */
#game{
  position:relative;
  width:100%;
  height:220px;
  border:3px solid #44ffcc;
  background:#000;
  overflow:hidden;
}

/* Fake parallax starfield */
.stars{
  position:absolute;
  top:0;left:0;
  width:200%;
  height:100%;
  background:
    radial-gradient(#fff 1px,transparent 1px) 0 0/8px 8px,
    radial-gradient(#44ffcc 1px,transparent 1px) 4px 4px/12px 12px;
  animation:scroll 8s linear infinite;
  opacity:0.6;
}
@keyframes scroll{
  from{transform:translateX(0);}
  to{transform:translateX(-50%);}
}

/* Hero */
#hero{
  position:absolute;
  left:10px;
  top:50%;
  width:24px;
  height:24px;
  margin-top:-12px;
  background:#00ccff;
  box-shadow:0 0 0 2px #003344;
}
#hero::before{
  content:'';
  position:absolute;
  left:14px;
  top:8px;
  width:8px;
  height:8px;
  background:#ffff00;
}

/* Enemy */
.enemy{
  position:absolute;
  width:20px;
  height:20px;
  background:#ff3366;
  box-shadow:0 0 0 2px #550011;
}

/* Boss */
#boss{
  position:absolute;
  right:10px;
  top:40px;
  width:40px;
  height:40px;
  background:#ff00ff;
  box-shadow:0 0 0 3px #330033;
  display:none;
}
#bossHealthBar{
  position:absolute;
  top:4px;
  left:50%;
  transform:translateX(-50%);
  width:80%;
  height:6px;
  border:1px solid #fff;
  margin-top:2px;
}
#bossHealthFill{
  width:100%;
  height:100%;
  background:#ff3366;
}

/* Laser */
.laser{
  position:absolute;
  width:10px;
  height:2px;
  background:#ffff00;
}

/* Brush power bar */
#powerWrap{
  position:absolute;
  bottom:4px;
  left:50%;
  transform:translateX(-50%);
  width:80%;
  height:8px;
  border:1px solid #fff;
}
#powerFill{
  width:0%;
  height:100%;
  background:#44ff44;
}

/* Overlay */
#overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:12px;
  z-index:10;
}
#overlay h2{
  font-size:14px;
  margin-bottom:8px;
}
#overlay p{
  font-size:8px;
  margin-bottom:8px;
}
button{
  font-family:'Press Start 2P',system-ui,monospace;
  font-size:8px;
  padding:6px 10px;
  border:none;
  background:#44ffcc;
  color:#000;
  margin:4px;
  cursor:pointer;
}
button:active{
  transform:translateY(1px);
}

/* Flash / hype */
.flash{
  animation:flash 0.2s linear 3;
}
@keyframes flash{
  0%,100%{background:#000;}
  50%{background:#441111;}
}
.hype{
  animation:hype 0.4s linear 4;
}
@keyframes hype{
  0%,100%{transform:scale(1);}
  50%{transform:scale(1.1);}
}

/* Tiny text row */
#bottomRow{
  margin-top:4px;
  font-size:7px;
  opacity:0.8;
}
</style>
</head>
<body>
<div id="overlay">
  <h2>TOOTH BLASTER 2084</h2>
  <p>BRUSH TO FIRE!<br>2 MINUTES • 4 ZONES • 1 BOSS</p>
  <p id="overlayMsg">Tap START, then start brushing like a maniac.</p>
  <button id="startBtn">START MISSION</button>
</div>

<div id="wrapper">
  <h1>TOOTH BLASTER 2084</h1>
  <div class="sub">BRUSH = LASER • DON’T LET THE ENEMIES WIN</div>

  <div id="hud">
    <div id="score">SCORE: 00000</div>
    <div id="timer">2:00</div>
    <div id="streak">CHAIN: 0</div>
  </div>

  <div id="quadrant">ZONE: 1 • TOP LEFT</div>

  <div id="game">
    <div class="stars"></div>
    <div id="hero"></div>
    <div id="boss">
      <div id="bossHealthBar"><div id="bossHealthFill"></div></div>
    </div>
    <div id="powerWrap"><div id="powerFill"></div></div>
  </div>

  <div id="bottomRow">
    TAP SCREEN WHILE BRUSHING TO KEEP FIRING • 2× A DAY = MAX POWER
  </div>
</div>

<script>
let totalTime = 120;
let timeLeft = totalTime;
let timerId = null;

let score = 0;
let chain = 0;
let crystals = parseInt(localStorage.getItem('tb_crystals')||'0',10);
let days = parseInt(localStorage.getItem('tb_days')||'0',10);

let audioCtx;
function initAudio(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext||window.webkitAudioContext)();
}
function beep(freq,dur,vol=0.2){
  if(!audioCtx) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type='square';
  osc.frequency.value=freq;
  gain.gain.value=vol;
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime+dur);
}
function vibrate(ms){
  if(navigator.vibrate) navigator.vibrate(ms);
}

const timerEl = document.getElementById('timer');
const scoreEl = document.getElementById('score');
const streakEl = document.getElementById('streak');
const quadrantEl = document.getElementById('quadrant');
const gameEl = document.getElementById('game');
const heroEl = document.getElementById('hero');
const bossEl = document.getElementById('boss');
const bossHealthFill = document.getElementById('bossHealthFill');
const powerFill = document.getElementById('powerFill');
const overlay = document.getElementById('overlay');
const overlayMsg = document.getElementById('overlayMsg');
const startBtn = document.getElementById('startBtn');

let bossHealth = 100;
let inBoss = false;
let firing = false;
let enemySpawnId = null;

function updateHUD(){
  scoreEl.textContent = 'SCORE: ' + String(score).padStart(5,'0');
  streakEl.textContent = 'CHAIN: ' + chain;
}

function updateTimer(){
  let m = Math.floor(timeLeft/60);
  let s = timeLeft%60;
  timerEl.textContent = m+':' + (s<10?'0'+s:s);
  if(timeLeft <= 10){
    timerEl.classList.add('flash');
    beep(900,0.08,0.3);
  }
}

function quadrantForTime(t){
  if(t>90) return 'ZONE: 1 • TOP LEFT';
  if(t>60) return 'ZONE: 2 • TOP RIGHT';
  if(t>30) return 'ZONE: 3 • BOTTOM LEFT';
  return 'ZONE: 4 • BOTTOM RIGHT';
}

function startGame(){
  initAudio();
  overlay.style.display='none';
  resetState();
  beep(400,0.1); beep(600,0.1); beep(800,0.1);
  vibrate(60);
  timerId = setInterval(tick,1000);
  enemySpawnId = setInterval(spawnEnemy,900);
}

function resetState(){
  timeLeft = totalTime;
  score = 0;
  chain = 0;
  bossHealth = 100;
  inBoss = false;
  timerEl.classList.remove('flash');
  bossEl.style.display='none';
  bossHealthFill.style.width='100%';
  powerFill.style.width='0%';
  clearEnemies();
  updateHUD();
  updateTimer();
  quadrantEl.textContent = quadrantForTime(timeLeft);
}

function tick(){
  timeLeft--;
  updateTimer();
  quadrantEl.textContent = quadrantForTime(timeLeft);

  if(timeLeft === 30 && !inBoss){
    // Boss appears for last 30s
    inBoss = true;
    bossEl.style.display='block';
    bossEl.classList.add('hype');
    beep(200,0.2,0.4);
    beep(120,0.2,0.4);
    setTimeout(()=>bossEl.classList.remove('hype'),600);
  }

  if(timeLeft <= 0){
    endGame();
  }
}

function endGame(){
  clearInterval(timerId);
  clearInterval(enemySpawnId);
  timerId = null;
  enemySpawnId = null;
  clearEnemies();
  timerEl.classList.remove('flash');

  let bonus = Math.floor(score/50) + chain*2;
  let totalCrystals = 10 + bonus;
  crystals += totalCrystals;
  days += 1;
  localStorage.setItem('tb_crystals',crystals);
  localStorage.setItem('tb_days',days);

  beep(800,0.15,0.4);
  beep(1000,0.15,0.4);
  beep(1200,0.25,0.5);
  vibrate(120);

  overlayMsg.textContent =
    'MISSION COMPLETE!\nSCORE: '+score+
    '\nCHAIN: '+chain+
    '\nCRYSTALS THIS RUN: '+totalCrystals+
    '\nTOTAL CRYSTALS: '+crystals+
    '\nDAYS PLAYED: '+days;
  startBtn.textContent = 'PLAY AGAIN';
  overlay.style.display='flex';
}

/* Enemies & lasers */
function spawnEnemy(){
  if(inBoss && Math.random()<0.4) return; // fewer small enemies during boss
  const e = document.createElement('div');
  e.className='enemy';
  const y = 20 + Math.random()*160;
  e.style.top = y+'px';
  e.style.left = (gameEl.clientWidth+20)+'px';
  gameEl.appendChild(e);

  const speed = 2 + Math.random()*2;
  let x = gameEl.clientWidth+20;
  const moveId = setInterval(()=>{
    x -= speed;
    e.style.left = x+'px';
    if(x < -30){
      clearInterval(moveId);
      e.remove();
      chain = 0;
      updateHUD();
    }
  },30);
  e.dataset.moveId = moveId;
}

function clearEnemies(){
  document.querySelectorAll('.enemy').forEach(e=>{
    clearInterval(e.dataset.moveId);
    e.remove();
  });
  document.querySelectorAll('.laser').forEach(l=>l.remove());
}

/* Firing = tapping while brushing */
function fireLaser(){
  if(!firing) return;
  const l = document.createElement('div');
  l.className='laser';
  const heroRect = heroEl.getBoundingClientRect();
  const gameRect = gameEl.getBoundingClientRect();
  let x = heroRect.right - gameRect.left;
  let y = heroRect.top - gameRect.top + 10;
  l.style.left = x+'px';
  l.style.top = y+'px';
  gameEl.appendChild(l);

  beep(700+Math.random()*200,0.05,0.25);

  let lx = x;
  const speed = 6;
  const moveId = setInterval(()=>{
    lx += speed;
    l.style.left = lx+'px';

    // Hit enemies
    document.querySelectorAll('.enemy').forEach(e=>{
      const er = e.getBoundingClientRect();
      const lr = l.getBoundingClientRect();
      if(lr.right>er.left && lr.left<er.right && lr.bottom>er.top && lr.top<er.bottom){
        e.classList.add('flash');
        setTimeout(()=>e.remove(),80);
        score += 10;
        chain += 1;
        updateHUD();
        powerUp(3);
      }
    });

    // Hit boss
    if(inBoss){
      const br = bossEl.getBoundingClientRect();
      const lr = l.getBoundingClientRect();
      if(lr.right>br.left && lr.left<br.right && lr.bottom>br.top && lr.top<br.bottom){
        bossHit();
      }
    }

    if(lx > gameEl.clientWidth+20){
      clearInterval(moveId);
      l.remove();
    }
  },30);
}

function bossHit(){
  bossHealth -= 2;
  if(bossHealth < 0) bossHealth = 0;
  bossHealthFill.style.width = bossHealth+'%';
  score += 5;
  chain += 1;
  updateHUD();
  powerUp(5);
  vibrate(40);
  beep(300,0.05,0.3);
  if(bossHealth === 0){
    inBoss = false;
    bossEl.classList.add('flash');
    setTimeout(()=>bossEl.style.display='none',200);
    score += 100;
    updateHUD();
  }
}

function powerUp(amount){
  let current = parseFloat(powerFill.style.width)||0;
  current += amount;
  if(current>100) current=100;
  powerFill.style.width = current+'%';
  if(current===100){
    // Screen blast
    gameEl.classList.add('hype');
    beep(1000,0.15,0.5);
    beep(1200,0.15,0.5);
    vibrate(100);
    document.querySelectorAll('.enemy').forEach(e=>e.remove());
    setTimeout(()=>{
      gameEl.classList.remove('hype');
      powerFill.style.width='0%';
    },300);
  }
}

/* Input: tap anywhere in game area to fire repeatedly while brushing */
gameEl.addEventListener('touchstart',e=>{
  e.preventDefault();
  firing = true;
});
gameEl.addEventListener('touchend',e=>{
  e.preventDefault();
  firing = false;
});
gameEl.addEventListener('mousedown',()=>{firing=true;});
gameEl.addEventListener('mouseup',()=>{firing=false;});
gameEl.addEventListener('mouseleave',()=>{firing=false;});

setInterval(()=>{
  if(firing && timerId){
    fireLaser();
  }
},120);

/* Start button */
startBtn.addEventListener('click',startGame);
</script>
</body>
</html>
