<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Exo-Brush: Galactic Defense</title>
    <style>
        :root {
            --neon-blue: #00f2ff; --exo-orange: #ff7b00; --gold: #ffd700;
            --damage: #ff2222; --bg: #03040a; --glass: rgba(0, 242, 255, 0.2);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; }
        body { background: var(--bg); font-family: 'Courier New', monospace; overflow: hidden; height: 100vh; display: flex; justify-content: center; }
        
        #viewport {
            position: relative; width: 100vw; height: 100vh; max-width: 430px; 
            background: radial-gradient(circle at center, #111 0%, #000 100%);
            overflow: hidden; border-left: 2px solid #222; border-right: 2px solid #222;
        }

        /* 1999 CRT SCANLINE OVERLAY */
        #viewport::after {
            content: ""; position: absolute; inset: 0; z-index: 9999; pointer-events: none;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%);
            background-size: 100% 4px; opacity: 0.6;
        }

        canvas { display: block; image-rendering: pixelated; }

        /* HUD */
        .hud { position: absolute; inset: 0; z-index: 1000; pointer-events: none; padding: env(safe-area-inset-top) 20px; }
        .hud-row { display: flex; justify-content: space-between; margin-top: 15px; }
        .stat-box { 
            background: rgba(0, 20, 40, 0.8); border: 1px solid var(--neon-blue);
            padding: 6px 12px; font-size: 11px; color: var(--neon-blue);
            text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 0 10px var(--neon-blue);
        }
        #timer-val { font-size: 52px; font-weight: 900; color: var(--gold); text-shadow: 0 0 20px var(--gold); text-align: center; }
        .boss-hp { width: 100%; height: 14px; background: #200; border: 1px solid #f00; margin-top: 10px; overflow: hidden; }
        #hp-bar { width: 100%; height: 100%; background: linear-gradient(90deg, #f00, #ff8c00); transition: width 0.2s; }

        /* UI SCREENS */
        .screen { position: absolute; inset: 0; z-index: 2000; background: rgba(0,0,0,0.96); display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 40px; }
        h1 { font-size: 44px; color: var(--exo-orange); text-shadow: 4px 4px #000; line-height: 0.9; margin-bottom: 20px; }
        .btn-prime { background: var(--exo-orange); border: 4px solid #fff; padding: 25px 60px; font-size: 24px; font-weight: 900; color: #fff; cursor: pointer; box-shadow: 0 10px 0 #830; border-radius: 4px; }
        .btn-prime:active { transform: translateY(4px); box-shadow: 0 6px 0 #830; }
        .hidden { display: none !important; }

        /* REWARDS */
        #loot-box { font-size: 120px; margin: 30px; animation: float 2s infinite ease-in-out; cursor: pointer; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

        /* PARENTAL */
        #parent-trigger { position: absolute; bottom: 0; right: 0; width: 60px; height: 60px; z-index: 5000; opacity: 0; }
    </style>
</head>
<body>

<div id="viewport">
    <div class="hud">
        <div class="hud-row">
            <div class="stat-box">DEFENSE: ACT-1</div>
            <div class="stat-box">STREAK: <span id="ui-streak">0</span></div>
        </div>
        <div id="timer-val">02:00</div>
        <div class="boss-hp"><div id="hp-bar"></div></div>
        <div class="hud-row" style="margin-top: 5px;">
            <div style="font-size: 10px; color: var(--damage);">THREAT: RUST-GOLIATH</div>
            <div style="font-size: 10px; color: var(--gold);">CRYSTALS: <span id="ui-cry">0</span></div>
        </div>
    </div>

    <canvas id="stage"></canvas>

    <div id="scr-start" class="screen">
        <div style="font-size: 14px; color: var(--neon-blue); letter-spacing: 5px; margin-bottom: 5px;">TACTICAL HYGIENE</div>
        <h1>EXO-BRUSH<br>SQUAD</h1>
        <button class="btn-prime" onclick="App.init()">LAUNCH MISSION</button>
        <p style="margin-top: 40px; font-size: 10px; color: #444;">1999 ELITE PROTOCOL v6.0</p>
    </div>

    <div id="scr-cd" class="screen hidden">
        <h3 style="color: var(--neon-blue);">SYNCING PILOT...</h3>
        <div id="cd-num" style="font-size: 140px; color: #fff; font-weight: 900;">5</div>
        <p>PREPARE TO BRUSH!</p>
    </div>

    <div id="scr-win" class="screen hidden">
        <h2 style="color: var(--gold); font-size: 32px;">GOLIATH DEFEATED</h2>
        <div id="loot-box" onclick="App.claim()">üéÅ</div>
        <div id="win-stats" class="hidden">
            <p id="loot-msg" style="color: var(--neon-blue); font-size: 18px;"></p>
            <button class="btn-prime" style="margin-top: 20px;" onclick="location.reload()">RETURN</button>
        </div>
    </div>

    <div id="parent-trigger" onclick="App.showParent()"></div>
</div>

<script>
/**
 * ---------------------------------------------------------------------
 *  EXO-BRUSH ENGINE: CINEMATIC 16-BIT ARCHITECTURE
 * ---------------------------------------------------------------------
 */

const App = {
    running: false, timer: 120, lastT: 0, shake: 0,
    save: JSON.parse(localStorage.getItem('exo_save')) || { streak: 0, cry: 0, last: null },
    
    stars: [], particles: [], bullets: [],
    hero: { x: 80, y: 0, recoil: 0, anim: 0 },
    boss: { x: 0, y: 0, hp: 3000, max: 3000, flash: 0, drift: 0 },

    init() {
        document.getElementById('scr-start').classList.add('hidden');
        this.canvas = document.getElementById('stage');
        this.ctx = this.canvas.getContext('2d', { alpha: false });
        this.resize();
        
        // Background Nebula & Stars
        for(let i=0; i<150; i++) {
            this.stars.push({
                x: Math.random() * this.canvas.width,
                y: Math.random() * this.canvas.height,
                v: Math.random() * 5 + 1,
                c: i % 10 === 0 ? '#ff00ff' : '#00f2ff',
                o: Math.random()
            });
        }

        window.onresize = () => this.resize();
        this.updateHUD();
        this.startCountdown();
    },

    resize() {
        this.canvas.width = window.innerWidth > 430 ? 430 : window.innerWidth;
        this.canvas.height = window.innerHeight;
        this.hero.y = this.canvas.height - 240;
        this.boss.x = this.canvas.width - 160;
    },

    startCountdown() {
        const scr = document.getElementById('scr-cd');
        const val = document.getElementById('cd-num');
        scr.classList.remove('hidden');
        let count = 5;
        const intr = setInterval(() => {
            count--; val.innerText = count;
            if(count === 0) {
                clearInterval(intr);
                scr.classList.add('hidden');
                this.running = true;
                this.lastT = performance.now();
                requestAnimationFrame((t) => this.loop(t));
            }
        }, 1000);
    },

    loop(t) {
        if(!this.running) return;
        const dt = (t - this.lastT) / 1000;
        this.lastT = t;
        this.update(dt);
        this.render();
        requestAnimationFrame((nt) => this.loop(nt));
    },

    update(dt) {
        this.timer -= dt;
        if(this.timer <= 0) this.win();

        if(this.shake > 0) this.shake *= 0.9;

        // Background
        this.stars.forEach(s => {
            s.y += s.v;
            if(s.y > this.canvas.height) s.y = -20;
        });

        // Hero AI (Exo-Suit Kid)
        this.hero.anim += dt * 3;
        this.hero.y = (this.canvas.height - 240) + Math.sin(this.hero.anim) * 20;
        if(this.hero.recoil > 0) this.hero.recoil -= 0.5;

        // Auto-Attack (Fixed Intervals)
        if(Math.random() > 0.94) {
            this.bullets.push({ x: this.hero.x + 50, y: this.hero.y + 35, v: 22 });
            this.hero.recoil = 6;
        }

        // Boss AI (Gnarly Robot)
        this.boss.drift += dt * 1.2;
        this.boss.y = 180 + Math.sin(this.boss.drift) * 60;
        if(this.boss.flash > 0) this.boss.flash--;

        // Collision & Damage
        this.boss.hp = (this.timer / 120) * this.boss.max; // Gradual damage

        this.bullets.forEach((b, i) => {
            b.x += b.v;
            if(b.x > this.boss.x && b.y > this.boss.y && b.y < this.boss.y + 200) {
                this.boss.flash = 6;
                this.shake = 6;
                this.spawnFX(b.x, b.y, '#ffd700');
                this.bullets.splice(i, 1);
            }
            if(b.x > this.canvas.width) this.bullets.splice(i, 1);
        });

        this.particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy; p.l -= 0.04;
            if(p.l <= 0) this.particles.splice(i, 1);
        });

        this.syncUI();
    },

    spawnFX(x, y, color) {
        for(let i=0; i<10; i++) {
            this.particles.push({
                x, y, vx: Math.random()*8, vy: (Math.random()-0.5)*15, 
                l: 1.0, c: color
            });
        }
    },

    syncUI() {
        const m = Math.floor(Math.max(0, this.timer) / 60);
        const s = Math.floor(Math.max(0, this.timer) % 60);
        const el = document.getElementById('timer-val');
        el.innerText = `${m}:${s < 10 ? '0'+s : s}`;
        document.getElementById('hp-bar').style.width = (this.boss.hp / this.boss.max * 100) + "%";
        
        if(this.timer <= 10) {
            el.style.color = "var(--damage)";
            if(Math.floor(Date.now()/200) % 2 === 0) el.style.opacity = 0.3;
            else el.style.opacity = 1;
        }
    },

    render() {
        const ctx = this.ctx;
        ctx.save();
        if(this.shake > 1) ctx.translate((Math.random()-0.5)*this.shake, (Math.random()-0.5)*this.shake);

        ctx.fillStyle = '#000'; ctx.fillRect(0,0,this.canvas.width, this.canvas.height);

        // Stars
        this.stars.forEach(s => {
            ctx.fillStyle = s.c; ctx.globalAlpha = s.o;
            ctx.fillRect(s.x, s.y, s.v/2, s.v/2);
        });
        ctx.globalAlpha = 1;

        // --- DRAW HERO (EXO-SUIT KID) ---
        const h = this.hero;
        // Legs/Base
        ctx.fillStyle = '#444'; ctx.fillRect(h.x-10-h.recoil, h.y+40, 60, 30);
        // Suit Body
        ctx.fillStyle = '#ff7b00'; ctx.fillRect(h.x-h.recoil, h.y+10, 50, 50);
        // Visor (Kid's Face Placeholder)
        ctx.fillStyle = '#00f2ff'; ctx.globalAlpha = 0.6;
        ctx.fillRect(h.x+15-h.recoil, h.y+20, 25, 15);
        ctx.globalAlpha = 1;
        // Shoulder Cannon
        ctx.fillStyle = '#222'; ctx.fillRect(h.x+35-h.recoil, h.y+30, 35, 18);

        // --- DRAW VILLAIN (GNARLY ROBOT) ---
        const b = this.boss;
        ctx.fillStyle = b.flash > 0 ? '#fff' : '#2a2a2a';
        // Massive Torso
        ctx.fillRect(b.x, b.y, 130, 200);
        // 4 Robot Arms
        ctx.fillStyle = '#1a1a1a';
        ctx.fillRect(b.x-40, b.y+20, 50, 20); ctx.fillRect(b.x-40, b.y+150, 50, 20);
        ctx.fillRect(b.x+120, b.y+20, 50, 20); ctx.fillRect(b.x+120, b.y+150, 50, 20);
        // Glowing Red Eyes
        ctx.fillStyle = '#f00';
        ctx.fillRect(b.x+20, b.y+40, 20, 10); ctx.fillRect(b.x+80, b.y+40, 20, 10);
        // Exposed Piston/Core
        ctx.fillStyle = '#ffd700'; ctx.beginPath();
        ctx.arc(b.x+65, b.y+120, 25 + Math.sin(Date.now()/200)*10, 0, Math.PI*2); ctx.fill();

        // Bullets & Particles
        ctx.fillStyle = 'cyan'; this.bullets.forEach(bul => ctx.fillRect(bul.x, bul.y, 25, 8));
        this.particles.forEach(p => {
            ctx.fillStyle = p.c; ctx.globalAlpha = p.l;
            ctx.fillRect(p.x, p.y, 5, 5);
        });

        ctx.restore();
    },

    win() {
        this.running = false;
        document.getElementById('scr-win').classList.remove('hidden');
    },

    claim() {
        const cry = 150 + (this.save.streak * 20);
        this.save.cry += cry;
        const today = new Date().toDateString();
        if(this.save.last !== today) { this.save.streak++; this.save.last = today; }
        
        document.getElementById('loot-box').innerHTML = "üíé";
        document.getElementById('win-stats').classList.remove('hidden');
        document.getElementById('loot-msg').innerText = `ACQUIRED: ${cry} CRYSTALS`;
        
        localStorage.setItem('exo_save', JSON.stringify(this.save));
        this.updateHUD();
    },

    updateHUD() {
        document.getElementById('ui-streak').innerText = this.save.streak;
        document.getElementById('ui-cry').innerText = this.save.cry;
    },

    showParent() { /* Math/PIN logic would go here */ }
};

App.updateHUD();
</script>

</body>
</html>
