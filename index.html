<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tooth Runner 2084</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body,html{margin:0;padding:0;background:#000;color:#fff;font-family:monospace;overflow:hidden;}
canvas{display:block;margin:0 auto;background:#000;image-rendering:pixelated;}
#hud{position:absolute;top:5px;width:100%;text-align:center;}
#timer{font-size:32px;color:#ff0;}
.danger{color:red;animation:flash 0.5s infinite;}
@keyframes flash{0%,100%{opacity:1}50%{opacity:0}}
#lootOverlay{position:absolute;inset:0;background:rgba(0,0,0,0.95);display:none;flex-direction:column;align-items:center;justify-content:center;color:#fff;font-size:18px;text-align:center;}
#lootBox{width:120px;height:120px;background:gold;border-radius:12px;display:flex;align-items:center;justify-content:center;margin:10px;cursor:pointer;box-shadow:0 0 15px #fff;}
#parentPanel{position:absolute;bottom:5px;right:5px;background:rgba(0,0,0,0.9);padding:5px;border:1px solid #444;display:none;}
#parentPanel input{width:40px;}
button{font-size:12px;padding:4px 8px;margin:2px;}
</style>
</head>
<body>

<canvas id="gameCanvas" width="320" height="480"></canvas>
<div id="hud">
  <div id="timer">2:00</div>
  <div id="zone">ENAMEL DISTRICT</div>
  <div>STREAK: <span id="streak">0</span> DAYS: <span id="days">0</span> CRYSTALS: <span id="crystals">0</span></div>
  <button id="startBtn">Start</button>
  <button id="pauseBtn">Pause</button>
  <button id="resetBtn">Reset</button>
  <button id="parentOpenBtn">Parent</button>
</div>

<div id="lootOverlay">
  <div>MISSION COMPLETE!</div>
  <div id="lootBox">TAP TO OPEN</div>
  <div id="lootText"></div>
  <button id="lootOkBtn">OK</button>
</div>

<div id="parentPanel">
  <div>
    Streak: <input id="ppStreak" type="number"><br>
    Days: <input id="ppDays" type="number"><br>
    Crystals: <input id="ppCrystals" type="number"><br>
    <button id="applyParent">Apply</button>
    <button id="closeParent">Close</button>
  </div>
</div>

<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");

let state={
  time:120,precount:5,running:false,paused:false,
  streak:0,days:0,crystals:0,
  zone:1,bossHealth:100,lootEarned:0,
  heroY:360,heroVY:0,onGround:true,
  particles:[],heroAnim:0
};

function save(){localStorage.setItem("tr_streak",state.streak);localStorage.setItem("tr_days",state.days);localStorage.setItem("tr_crystals",state.crystals);}
function load(){state.streak=parseInt(localStorage.getItem("tr_streak")||"0");state.days=parseInt(localStorage.getItem("tr_days")||"0");state.crystals=parseInt(localStorage.getItem("tr_crystals")||"0");}
function updateHUD(){
  document.getElementById("streak").textContent=state.streak;
  document.getElementById("days").textContent=state.days;
  document.getElementById("crystals").textContent=state.crystals;
  document.getElementById("zone").textContent=["ENAMEL DISTRICT","FLOSS HIGHWAY","GUMLINE FORGE","CAVITY CORE"][state.zone-1]||"ENAMEL DISTRICT";
  let mins=Math.floor(state.time/60);
  let secs=Math.floor(state.time%60);
  let tEl=document.getElementById("timer");
  tEl.textContent=mins+":"+(secs<10?"0"+secs:secs);
  if(state.time<=10)tEl.classList.add("danger"); else tEl.classList.remove("danger");
}

function startGame(){state.running=true;state.paused=false;state.time=120;state.precount=5;state.zone=1;state.bossHealth=100;updateHUD();}
function pauseGame(){state.paused=!state.paused;}
function resetGame(){state.running=false;state.paused=false;state.time=120;state.zone=1;state.bossHealth=100;updateHUD();}

document.getElementById("startBtn").onclick=startGame;
document.getElementById("pauseBtn").onclick=pauseGame;
document.getElementById("resetBtn").onclick=resetGame;
document.getElementById("parentOpenBtn").onclick=()=>{document.getElementById("parentPanel").style.display="block";document.getElementById("ppStreak").value=state.streak;document.getElementById("ppDays").value=state.days;document.getElementById("ppCrystals").value=state.crystals;};
document.getElementById("closeParent").onclick=()=>{document.getElementById("parentPanel").style.display="none";};
document.getElementById("applyParent").onclick=()=>{
  state.streak=Number(document.getElementById("ppStreak").value);
  state.days=Number(document.getElementById("ppDays").value);
  state.crystals=Number(document.getElementById("ppCrystals").value);
  save();updateHUD();document.getElementById("parentPanel").style.display="none";
};

const beep=new AudioContext();
function beepSound(){let osc=beep.createOscillator();osc.connect(beep.destination);osc.frequency.value=440;osc.start();osc.stop(beep.currentTime+0.1);}

document.getElementById("lootBox").onclick=()=>{
  document.getElementById("lootText").textContent="Crystals this run: "+state.lootEarned+"\nTotal: "+state.crystals;
};

document.getElementById("lootOkBtn").onclick=()=>{
  document.getElementById("lootOverlay").style.display="none";
  resetGame();
};

function damageBoss(amount){state.bossHealth=Math.max(0,state.bossHealth-amount);state.particles.push({x:240,y:100,vx:(Math.random()-0.5)*100,vy:(Math.random()-0.5)*100,life:0.6,color:"#ff0"});}

function update(dt){
  if(!state.running||state.paused)return;
  if(state.precount>0){state.precount-=dt;return;}
  state.time-=dt;
  if(state.time<=0){
    state.time=0;
    state.running=false;
    state.days++;
    state.streak++;
    state.lootEarned=5;
    state.crystals+=state.lootEarned;
    save();
    document.getElementById("lootOverlay").style.display="flex";
  }
  if(Math.floor(state.time)%30===0 && state.time>0){damageBoss(20);state.zone=Math.min(4,Math.floor((120-state.time)/30)+1);}
  state.heroVY+=400*dt;
  state.heroY+=state.heroVY*dt;
  if(state.heroY>=360){state.heroY=360;state.heroVY=0;state.onGround=true;}
  state.particles.forEach(p=>{p.x+=p.vx*dt;p.y+=p.vy*dt;p.life-=dt;});
  state.particles=state.particles.filter(p=>p.life>0);
  if(state.time<=10)beepSound();
  updateHUD();
}

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#111"; ctx.fillRect(0,392,320,88);
  ctx.fillStyle="#0ff"; ctx.fillRect(60,state.heroY,16,32);
  ctx.fillStyle="#f22"; ctx.fillRect(240,100,64,64);
  state.particles.forEach(p=>{ctx.fillStyle=p.color;ctx.fillRect(p.x,p.y,2,2);});
}

let lastTs=0;
function loop(ts){let dt=(ts-lastTs)/1000||0;lastTs=ts;update(dt);render();requestAnimationFrame(loop);}
load();updateHUD();requestAnimationFrame(loop);
</script>
</body>
</html>
