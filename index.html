<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Tooth City Defender</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
margin:0;
font-family:'Inter',sans-serif;
background:linear-gradient(180deg,#0c1220,#101a33);
color:white;
text-align:center;
overflow:hidden;
}

h1{
font-family:'Orbitron',sans-serif;
margin:12px 0;
font-size:22px;
}

.timer{
font-size:60px;
font-weight:800;
margin:10px 0;
transition:0.3s;
}

.red{color:#ff4d4d;}
.flash{animation:flash 0.5s infinite;}
@keyframes flash{
0%{opacity:1;}
50%{opacity:0.4;}
100%{opacity:1;}
}

.robot{
font-size:90px;
transition:0.4s;
}

.health-bar{
height:12px;
width:80%;
margin:8px auto;
background:#222;
border-radius:6px;
overflow:hidden;
}

.health-fill{
height:100%;
width:100%;
background:linear-gradient(to right,#ff3b3b,#ffcc00);
transition:width 0.5s ease;
}

button{
padding:12px 18px;
margin:6px;
border:none;
border-radius:14px;
font-weight:600;
background:linear-gradient(145deg,#1f4068,#162447);
color:white;
box-shadow:0 4px 16px rgba(0,0,0,0.5);
}

.city{
display:flex;
justify-content:center;
gap:8px;
margin-top:10px;
}

.building{
width:18px;
height:18px;
background:#333;
border-radius:4px;
}

.built{
background:linear-gradient(180deg,#5cffc8,#00c896);
}

.calendar{
display:grid;
grid-template-columns:repeat(7,1fr);
gap:4px;
width:90%;
margin:10px auto;
}

.day{
height:22px;
background:#222;
border-radius:4px;
}

.day.done{
background:#00c896;
}

.overlay{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.9);
display:none;
justify-content:center;
align-items:center;
flex-direction:column;
z-index:10;
}

.reward{
font-size:28px;
margin:10px;
}

.parent{
position:absolute;
bottom:6px;
width:100%;
font-size:12px;
opacity:0.6;
}
</style>
</head>

<body>

<h1>Tooth City Defender</h1>

<div class="timer" id="timer">2:00</div>

<div class="robot" id="robot">ðŸ¤–</div>

<div class="health-bar">
<div class="health-fill" id="healthFill"></div>
</div>

<div>
<button onclick="startTimer()">Start</button>
<button onclick="pauseTimer()">Pause</button>
<button onclick="resetTimer()">Reset</button>
</div>

<h3>Tooth City</h3>
<div class="city" id="city"></div>

<h3>30 Day Chain</h3>
<div class="calendar" id="calendar"></div>

<div id="stats"></div>

<div class="parent">
<button onclick="resetAll()">Parent Reset</button>
</div>

<div class="overlay" id="overlay">
<div class="reward" id="rewardText"></div>
<button onclick="closeOverlay()">Continue</button>
</div>

<script>
let total=120;
let time=120;
let interval=null;
let health=100;
let dayCount=parseInt(localStorage.getItem("dayCount")||0);
let crystals=parseInt(localStorage.getItem("crystals")||0);
let streak=parseInt(localStorage.getItem("streak")||0);

let audioCtx;

function initAudio(){
audioCtx=new(window.AudioContext||window.webkitAudioContext)();
}

function tone(freq,dur){
const osc=audioCtx.createOscillator();
osc.type="square";
osc.frequency.setValueAtTime(freq,audioCtx.currentTime);
osc.connect(audioCtx.destination);
osc.start();
osc.stop(audioCtx.currentTime+dur);
}

function haptic(){
if(navigator.vibrate) navigator.vibrate(80);
}

function buildCity(){
const city=document.getElementById("city");
city.innerHTML="";
for(let i=0;i<10;i++){
let b=document.createElement("div");
b.className="building";
if(i<Math.floor(dayCount/3)) b.classList.add("built");
city.appendChild(b);
}
}

function buildCalendar(){
const cal=document.getElementById("calendar");
cal.innerHTML="";
for(let i=1;i<=30;i++){
let d=document.createElement("div");
d.className="day";
if(i<=dayCount) d.classList.add("done");
cal.appendChild(d);
}
}

function updateStats(){
document.getElementById("stats").innerText=
"Day: "+dayCount+
" | Streak: "+streak+
" | Crystals: "+crystals;
}

function startTimer(){
if(!audioCtx) initAudio();
if(interval) return;

let pre=5;
document.getElementById("timer").innerText=pre;
interval=setInterval(()=>{
pre--;
if(pre>0){
document.getElementById("timer").innerText=pre;
}else{
clearInterval(interval);
interval=null;
runMain();
}
},1000);
}

function runMain(){
interval=setInterval(()=>{
time--;
updateTimer();
updateRobot();

if(time<=0){
clearInterval(interval);
interval=null;
victory();
}
},1000);
}

function updateTimer(){
let m=Math.floor(time/60);
let s=time%60;
let display=m+":"+(s<10?"0"+s:s);
let t=document.getElementById("timer");
t.innerText=display;

if(time<=10){
t.classList.add("red","flash");
tone(900,0.1);
}
}

function updateRobot(){
let elapsed=120-time;
if(elapsed%30===0 && elapsed!==0){
health-=25;
document.getElementById("healthFill").style.width=health+"%";
document.getElementById("robot").style.transform="scale(0.9)";
setTimeout(()=>document.getElementById("robot").style.transform="scale(1)",200);
tone(200,0.2);
haptic();
}

if(dayCount>0 && dayCount%7===6){
document.getElementById("robot").innerText="ðŸ‘¹";
}else{
document.getElementById("robot").innerText="ðŸ¤–";
}
}

function victory(){
tone(1200,0.4);
haptic();

dayCount++;
streak++;
let baseReward=10;
let streakBonus=Math.floor(streak/5)*5;
let reward=baseReward+streakBonus;

if(dayCount%7===0){
reward+=20;
}

crystals+=reward;

localStorage.setItem("dayCount",dayCount);
localStorage.setItem("streak",streak);
localStorage.setItem("crystals",crystals);

showReward(reward);
}

function showReward(amount){
document.getElementById("overlay").style.display="flex";
document.getElementById("rewardText").innerText=
"You defeated the robot!\nEarned "+amount+" crystals ðŸ’Ž";
buildCity();
buildCalendar();
updateStats();
}

function closeOverlay(){
document.getElementById("overlay").style.display="none";
resetTimer();
}

function pauseTimer(){
clearInterval(interval);
interval=null;
}

function resetTimer(){
clearInterval(interval);
interval=null;
time=120;
health=100;
document.getElementById("healthFill").style.width="100%";
document.getElementById("timer").classList.remove("red","flash");
document.getElementById("timer").innerText="2:00";
}

function resetAll(){
if(confirm("Reset all progress?")){
localStorage.clear();
dayCount=0;
crystals=0;
streak=0;
buildCity();
buildCalendar();
updateStats();
}
}

buildCity();
buildCalendar();
updateStats();
</script>

</body>
</html>
