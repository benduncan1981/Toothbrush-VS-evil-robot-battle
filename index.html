<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tooth Ranger: Plaque Planet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* --- Reset & Base --- */
*{margin:0;padding:0;box-sizing:border-box}
body{background:#02030a;color:#fff;font-family:'Press Start 2P',sans-serif;display:flex;justify-content:center;align-items:flex-start;height:100vh;overflow:hidden}
.app{width:100%;max-width:430px;padding:12px;display:flex;flex-direction:column;align-items:center}
h1{text-align:center;color:#0ff;font-family:Orbitron,sans-serif;font-size:20px;margin-bottom:8px;text-shadow:0 0 6px #0ff}
#timer{font-family:Orbitron,sans-serif;font-size:48px;text-align:center;margin:6px 0}
#timer.danger{color:#f22;animation:flash 0.5s infinite}
@keyframes flash{50%{opacity:0.3}}
#zone{text-align:center;font-size:12px;margin-bottom:4px;color:#0ff;text-shadow:0 0 3px #0ff}
canvas{width:100%;height:260px;background:#000;border-radius:18px;box-shadow:0 0 30px rgba(0,255,255,0.2)}
.controls{display:flex;justify-content:space-between;margin-top:6px;width:100%}
button{flex:1;margin:2px;padding:12px;border:none;border-radius:12px;background:#111;color:white;font-weight:600;cursor:pointer;transition:0.2s}
button.primary{background:#0ff;color:black}
button:active{transform:translateY(2px)}
#stats{text-align:center;font-size:12px;margin-top:6px;opacity:0.8}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;flex-direction:column;z-index:100}
.lootbox{background:#111;padding:24px;border-radius:20px;text-align:center;box-shadow:0 0 20px #0ff}
.crystal{font-size:50px;animation:spin 2s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.parent{text-align:center;font-size:11px;opacity:0.5;margin-top:auto}
#parentPanel{position:fixed;right:6px;bottom:6px;width:280px;background:rgba(0,0,0,0.95);border:2px solid #444;padding:10px;font-size:9px;display:none;z-index:200;border-radius:10px}
#parentPanel input{width:100%;padding:4px;margin-bottom:4px;background:#111;color:#fff;border:1px solid #444;border-radius:4px}
#parentPanel button{width:48%;margin:2%;padding:6px;background:#0ff;color:#000;border:none;border-radius:6px;font-weight:600}
</style>
</head>
<body>
<div class="app">
<h1>TOOTH RANGER</h1>
<div id="timer">2:00</div>
<div id="zone">ENAMEL DISTRICT</div>
<canvas id="game" width="400" height="260"></canvas>
<div class="controls">
<button class="primary" onclick="Game.start()">Start</button>
<button onclick="Game.pause()">Pause</button>
<button onclick="Game.reset()">Reset</button>
</div>
<div id="stats"></div>
<div class="parent"><button onclick="Game.showParent()">Parent Controls</button></div>
</div>

<div class="overlay" id="lootOverlay">
<div class="lootbox">
<h2>Mission Complete!</h2>
<div class="crystal">ðŸ’Ž</div>
<p id="lootText"></p>
<button onclick="Game.closeLoot()">Continue</button>
</div>
</div>

<div id="parentPanel">
<h3>Parent Panel</h3>
<label>Daily Count:</label><input id="ppDaily" type="number">
<label>Streak:</label><input id="ppStreak" type="number">
<label>Crystals:</label><input id="ppCrystals" type="number">
<button onclick="Game.applyParent()">Apply</button>
<button onclick="Game.resetParent()">Reset All</button>
</div>

<script>
const Game={
TOTAL:120,
PRECOUNT:5,
time:120,
state:"idle",
zoneIndex:0,
streak:Number(localStorage.getItem("streak")||0),
daily:Number(localStorage.getItem("daily")||0),
crystals:Number(localStorage.getItem("crystals")||0),
lastDate:localStorage.getItem("lastDate")||"",
bossHealth:100,
particles:[],
canvas:null,
ctx:null,
lastFrame:0,
heroFrames:[],
bossFrames:[],
heroAnim:0,
heroX:60, heroY:160, heroVY:0, groundY:200,
parentPass:"1234",

init(){
this.canvas=document.getElementById("game");
this.ctx=this.canvas.getContext("2d");
this.loadSprites();
this.updateStats();
requestAnimationFrame(this.loop.bind(this));
},

loadSprites(){
// Hero 32x32 sprite sheet base64 embedded
let h=new Image();h.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAHklEQVR42mNgGAU0A4yMhjAEYzAjAGbQ1EYAAAOq5FjvWf1DAAAAAElFTkSuQmCC";
this.heroFrames.push(h);
// Boss 64x64
let b=new Image();b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAABH9v8kAAAAQ0lEQVR42mNgGAWjYBSMglEwCqIgglEE6QAcYHnYgDqEPCsDhA7g1QvAeCkgd4XgAAxrjGzQAAByYXHxFXjK50AAAAASUVORK5CYII=";
this.bossFrames.push(b);
},

start(){
if(this.state==="running")return;
this.state="precount";
let c=this.PRECOUNT;
document.getElementById("timer").textContent="Deploy in "+c;
let pre=setInterval(()=>{
c--;
if(c>0)document.getElementById("timer").textContent="Deploy in "+c;
else{clearInterval(pre);this.state="running";this.time=this.TOTAL;this.bossHealth=100;}
},1000);
},

pause(){if(this.state==="running")this.state="paused";else if(this.state==="paused")this.state="running";},

reset(){
this.state="idle";
this.time=this.TOTAL;
this.bossHealth=100;
document.getElementById("timer").classList.remove("danger");
document.getElementById("timer").textContent="2:00";
},

loop(ts){
let delta=(ts-this.lastFrame)/1000;
this.lastFrame=ts;
if(this.state==="running"){
this.time-=delta;
if(this.time<=0){this.complete();}
this.bossHealth=(this.time/this.TOTAL)*100;
this.updateTimer();
this.updateZone();
this.updateParticles();
}
this.render();
requestAnimationFrame(this.loop.bind(this));
},

updateTimer(){
let t=Math.max(0,Math.floor(this.time));
let m=Math.floor(t/60);
let s=t%60;
let el=document.getElementById("timer");
el.textContent=`${m}:${s.toString().padStart(2,"0")}`;
if(t<=10){el.classList.add("danger");this.alarm();}
else el.classList.remove("danger");
},

updateZone(){
let z=Math.floor((this.TOTAL-this.time)/30);
const zones=["ENAMEL DISTRICT","FLOSS HIGHWAY","GUMLINE FORGE","CAVITY CORE"];
document.getElementById("zone").textContent=zones[z]||"";
},

render(){
const ctx=this.ctx;
ctx.clearRect(0,0,400,260);
// Parallax background
ctx.fillStyle="#02030a";ctx.fillRect(0,0,400,260);
ctx.fillStyle="#04122a";for(let i=0;i<20;i++){ctx.fillRect((i*50+Date.now()/30)%400,180,20,40);}
// Hero
ctx.drawImage(this.heroFrames[0],this.heroX,this.heroY,32,32);
// Boss
ctx.fillStyle=this.bossHealth>60?"#f22":this.bossHealth>30?"#f90":"#666";
ctx.drawImage(this.bossFrames[0],280,100,64,64);
// Particles
this.particles.forEach(p=>{ctx.fillStyle=p.color;ctx.fillRect(p.x,p.y,2,2);});
},

updateParticles(){this.particles.forEach(p=>{p.life-=1/60;p.y-=1;});this.particles=this.particles.filter(p=>p.life>0);},

complete(){
this.state="complete";
let today=new Date().toDateString();
if(today!==this.lastDate){this.daily++;this.streak++;this.lastDate=today;}
let reward=Math.floor(Math.random()*20)+15;
this.crystals+=reward;
this.save();
this.updateStats();
document.getElementById("lootText").textContent="You earned "+reward+" Crystals!";
document.getElementById("lootOverlay").style.display="flex";
},

closeLoot(){document.getElementById("lootOverlay").style.display="none";this.reset();},

showParent(){
document.getElementById("parentPanel").style.display="block";
document.getElementById("ppDaily").value=this.daily;
document.getElementById("ppStreak").value=this.streak;
document.getElementById("ppCrystals").value=this.crystals;
},

applyParent(){
this.daily=Number(document.getElementById("ppDaily").value);
this.streak=Number(document.getElementById("ppStreak").value);
this.crystals=Number(document.getElementById("ppCrystals").value);
this.save();
this.updateStats();
document.getElementById("parentPanel").style.display="none";
},

resetParent(){
if(confirm("Reset all progress?")){
this.daily=0;this.streak=0;this.crystals=0;this.save();this.updateStats();
document.getElementById("parentPanel").style.display="none";
}
},

updateStats(){
document.getElementById("stats").textContent="Crystals: "+this.crystals+" | Streak: "+this.streak+" | Today: "+this.daily;
},

save(){
localStorage.setItem("streak",this.streak);
localStorage.setItem("daily",this.daily);
localStorage.setItem("crystals",this.crystals);
localStorage.setItem("lastDate",this.lastDate);
},

alarm(){try{let ctxA=new(window.AudioContext||window.webkitAudioContext)();let osc=ctxA.createOscillator();osc.frequency.value=600;osc.connect(ctxA.destination);osc.start();osc.stop(ctxA.currentTime+0.05);}catch(e){}}
};

Game.init();
</script>
</body>
</html>
