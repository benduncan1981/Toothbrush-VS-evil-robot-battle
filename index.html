<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TITAN SCRUB: GBA EDITION</title>
    <style>
        :root {
            --bg: #050505;
            --hud-gold: #ffd24d;
            --hud-cyan: #0ff6ff;
            --font: 'Courier New', Courier, monospace;
        }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: var(--bg); overflow: hidden; 
            display: flex; justify-content: center; align-items: center;
            font-family: var(--font);
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            max-width: 430px; /* iPhone 15 width approx */
            aspect-ratio: 9/19.5;
            background: #111;
            image-rendering: pixelated;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        canvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
        #hud {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .hud-bar {
            height: 12px;
            background: #222;
            border: 2px solid #444;
            position: relative;
            overflow: hidden;
        }
        #progress-fill {
            width: 100%;
            height: 100%;
            background: var(--hud-cyan);
            transition: width 0.3s linear;
            box-shadow: 0 0 10px var(--hud-cyan);
        }
        .label {
            color: var(--hud-gold);
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 4px;
            text-shadow: 2px 2px #000;
        }
        #start-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            text-align: center;
            color: white;
        }
        button {
            background: var(--hud-gold);
            border: none;
            padding: 15px 40px;
            font-family: var(--font);
            font-weight: bold;
            font-size: 20px;
            cursor: pointer;
            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    <div id="hud">
        <div>
            <div class="label">Sectors Remaining</div>
            <div class="hud-bar"><div id="progress-fill"></div></div>
        </div>
        <div style="text-align: center;">
            <div id="zone-text" class="label" style="font-size: 18px; color: #fff;">BRUSHING ZONE: LOWER LEFT</div>
        </div>
        <div style="display: flex; justify-content: space-between;">
            <div>
                <div class="label">Plaque HP</div>
                <div id="boss-hp" style="color: #ff6b6b; font-size: 24px; font-weight: 900;">100%</div>
            </div>
            <div style="text-align: right;">
                <div class="label">Combo</div>
                <div id="score-text" style="color: var(--hud-cyan); font-size: 24px;">0000</div>
            </div>
        </div>
    </div>

    <div id="start-overlay">
        <h1 style="color: var(--hud-cyan); margin-bottom: 5px;">TITAN SCRUB</h1>
        <p style="margin-bottom: 30px; font-size: 12px; color: #999;">CLEAN THE TITAN â€¢ SAVE THE GALAXY</p>
        <button onclick="startGame()">ENGAGE</button>
    </div>
</div>

<script>
/** 
 * GBA-MAX BITMASK ENGINE
 * 12-Color Master Palette
 */
const PALETTE = [
    null,      // 0: Transparent
    '#000000', // 1: Black
    '#0ff6ff', // 2: Cyan Visor
    '#00b3b3', // 3: Dark Cyan
    '#bfefff', // 4: Visor Highlight
    '#ffd24d', // 5: Gold
    '#ffb36b', // 6: Warm Metal
    '#ff6b6b', // 7: Core Red
    '#444444', // 8: Dark Gray
    '#999999', // 9: Plate Gray
    '#222222', // 10: Shadow
    '#ffffff'  // 11: Flash
];

// HERO BITMASK (72x72 logical) - Simplified representation for demo
// 0=trans, 9=plate, 2=visor, 5=gold
const HERO_DATA = [
    [0,0,9,9,9,0,0],
    [0,9,2,2,9,9,0],
    [9,9,2,2,2,9,9],
    [9,9,9,9,9,9,9],
    [0,8,8,0,8,8,0]
];

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const dpr = window.devicePixelRatio || 1;
let width, height;

let state = {
    running: false,
    timer: 120, // 2 minutes
    timeLeft: 120,
    bossHP: 100,
    score: 0,
    frame: 0,
    particles: [],
    zones: ["LOWER LEFT", "LOWER RIGHT", "UPPER LEFT", "UPPER RIGHT", "FRONT"],
    currentZone: 0
};

function init() {
    width = canvas.width = canvas.offsetWidth * dpr;
    height = canvas.height = canvas.offsetHeight * dpr;
    ctx.scale(dpr, dpr);
    ctx.imageSmoothingEnabled = false;
}

function drawSprite(data, ox, oy, scale, flip = false) {
    const s = scale;
    for(let y = 0; y < data.length; y++) {
        for(let x = 0; x < data[y].length; x++) {
            const idx = data[y][x];
            if(idx === 0) continue;
            ctx.fillStyle = PALETTE[idx];
            const px = flip ? ox + (data[y].length - x) * s : ox + x * s;
            ctx.fillRect(px, oy + y * s, s, s);
        }
    }
}

function spawnParticle() {
    state.particles.push({
        x: 150 + Math.random() * 100,
        y: 200 + Math.random() * 150,
        vx: (Math.random() - 0.5) * 10,
        vy: -Math.random() * 15,
        life: 1.0,
        color: Math.random() > 0.5 ? 2 : 11
    });
}

function update() {
    if(!state.running) return;
    
    state.frame++;
    state.timeLeft -= 1/60;
    
    // Deterministic Progression Logic
    const progress = state.timeLeft / state.timer;
    state.bossHP = Math.max(0, Math.floor(progress * 100));
    document.getElementById('progress-fill').style.width = (progress * 100) + "%";
    document.getElementById('boss-hp').innerText = state.bossHP + "%";
    document.getElementById('score-text').innerText = Math.floor((120 - state.timeLeft) * 100).toString().padStart(4, '0');

    // Zone rotation every 24 seconds
    const zoneIdx = Math.floor((120 - state.timeLeft) / 24);
    if(zoneIdx !== state.currentZone && zoneIdx < 5) {
        state.currentZone = zoneIdx;
        document.getElementById('zone-text').innerText = "BRUSHING ZONE: " + state.zones[zoneIdx];
        // Flash effect
        ctx.fillStyle = 'white';
        ctx.fillRect(0,0,width,height);
    }

    // Particle physics
    state.particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy; p.vy += 0.5; p.life -= 0.02;
        if(p.life <= 0) state.particles.splice(i, 1);
    });

    if(state.frame % 3 === 0) spawnParticle();
    if(state.timeLeft <= 0) state.running = false;

    render();
    requestAnimationFrame(update);
}

function render() {
    const w = canvas.offsetWidth;
    const h = canvas.offsetHeight;
    
    // Background: Parallax Stars
    ctx.fillStyle = '#050505';
    ctx.fillRect(0, 0, w, h);
    
    // "Titan" Villain (Procedural Sine Float)
    const float = Math.sin(state.frame * 0.05) * 10;
    ctx.fillStyle = '#222';
    ctx.fillRect(w/2 - 80, 150 + float, 160, 200); // Base Plate
    
    // Core Pulse
    const pulse = Math.abs(Math.sin(state.frame * 0.1));
    ctx.shadowBlur = 20 * pulse;
    ctx.shadowColor = PALETTE[7];
    ctx.fillStyle = PALETTE[7];
    ctx.beginPath();
    ctx.arc(w/2, 250 + float, 30, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;

    // Plaque Overlay (Green grime that disappears)
    ctx.fillStyle = `rgba(100, 255, 100, ${state.bossHP/100 * 0.5})`;
    ctx.fillRect(w/2 - 70, 160 + float, 140, 180);

    // Hero: Exo-Pilot
    const heroY = h - 220 + Math.sin(state.frame * 0.08) * 5;
    drawSprite(HERO_DATA, w/2 - 35, heroY, 10);
    
    // Laser Beam (Visual feedback for "brushing")
    ctx.strokeStyle = PALETTE[2];
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(w/2, heroY);
    ctx.lineTo(w/2 + (Math.sin(state.frame * 0.2) * 50), 250 + float);
    ctx.stroke();

    // Draw Particles
    state.particles.forEach(p => {
        ctx.fillStyle = PALETTE[p.color];
        ctx.globalAlpha = p.life;
        ctx.fillRect(p.x, p.y, 4, 4);
    });
    ctx.globalAlpha = 1;
}

function startGame() {
    document.getElementById('start-overlay').style.display = 'none';
    state.running = true;
    init();
    update();
    
    // Haptic Feedback Simulation (if mobile)
    if(navigator.vibrate) navigator.vibrate([100, 50, 100]);
}

window.addEventListener('resize', init);
init();
render();
</script>
</body>
</html>
