<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Metroid Brush: Ultra-Elite 16-Bit</title>
    <style>
        :root { --p-blue: #00f2ff; --p-red: #ff3333; --p-gold: #ffd700; --p-orange: #ff7b00; --p-bg: #030305; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; }
        body { background: var(--p-bg); font-family: 'Courier New', monospace; overflow: hidden; height: 100vh; display: flex; justify-content: center; }
        
        #viewport { position: relative; width: 100vw; height: 100vh; max-width: 430px; background: #000; overflow: hidden; }

        /* CRT SCANLINE SHADER */
        #viewport::after {
            content: " "; display: block; position: absolute; inset: 0; z-index: 1000; pointer-events: none;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%);
            background-size: 100% 4px;
        }

        canvas { display: block; image-rendering: pixelated; }

        /* HUD & UI */
        .hud-layer { position: absolute; inset: 0; z-index: 500; pointer-events: none; padding-top: env(safe-area-inset-top); }
        .hud-top { display: flex; justify-content: space-between; padding: 15px; }
        .hud-box { background: rgba(0, 20, 50, 0.8); border: 1px solid var(--p-blue); padding: 5px 10px; font-size: 10px; color: var(--p-blue); }
        #timer-text { font-size: 44px; font-weight: 900; color: var(--p-gold); text-shadow: 0 0 15px var(--p-gold); text-align: center; }
        
        .hp-container { width: 90%; height: 12px; background: #300; border: 1px solid #f00; margin: 10px auto; position: relative; }
        #hp-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #f00, #ff8c00); transition: width 0.1s; }

        /* SCREENS */
        .overlay { position: absolute; inset: 0; z-index: 2000; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 30px; }
        .btn-start { background: var(--p-orange); border: 4px solid #fff; padding: 25px 60px; font-size: 24px; font-weight: bold; color: white; cursor: pointer; box-shadow: 0 10px 0 #930; border-radius: 4px; }
        .btn-start:active { transform: translateY(4px); box-shadow: 0 6px 0 #930; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="viewport">
    <div class="hud-layer">
        <div class="hud-top">
            <div class="hud-box">MISSION: BRUSH-ZERO</div>
            <div class="hud-box">STREAK: <span id="ui-streak">0</span></div>
        </div>
        <div id="timer-text">02:00</div>
        <div class="hp-container"><div id="hp-fill"></div></div>
        <div style="font-size: 8px; color: var(--p-red); text-align: center; letter-spacing: 2px;">THREAT: OMEGA-CAVITY</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="screen-start" class="overlay">
        <h1 style="color: var(--p-orange); font-size: 44px; margin-bottom: 5px;">METROID</h1>
        <h2 style="color: var(--p-blue); font-size: 20px; margin-bottom: 30px; letter-spacing: 5px;">BRUSH ELITE</h2>
        <button class="btn-start" onclick="engine.start()">INITIALIZE</button>
    </div>

    <div id="screen-win" class="overlay hidden">
        <h1 style="color: var(--p-gold); font-size: 32px;">MISSION CLEAR</h1>
        <div style="font-size: 100px; margin: 30px; cursor: pointer;" onclick="location.reload()">ðŸ“¦</div>
        <p style="color: var(--p-blue);">DATA EXTRACTED & SAVED</p>
    </div>
</div>

<script>
/**
 * BRUSH ELITE ENGINE v4.0
 * Fully Procedural 16-Bit Simulation
 */
const engine = {
    running: false, timer: 120, lastT: 0,
    data: JSON.parse(localStorage.getItem('brush_v4_data')) || { streak: 0, cry: 0 },
    entities: { stars: [], bullets: [], fx: [], hero: { y: 0, state: 'idle' }, boss: { hp: 2000, y: 0, flash: 0 } },

    init() {
        this.canvas = document.getElementById('gameCanvas');
        this.ctx = this.canvas.getContext('2d');
        this.resize();
        window.addEventListener('resize', () => this.resize());
        
        // Generate Parallax Starfield
        for(let i=0; i<150; i++) {
            this.entities.stars.push({
                x: Math.random() * this.canvas.width,
                y: Math.random() * this.canvas.height,
                s: Math.random() * 4 + 1,
                c: i % 2 === 0 ? '#fff' : '#44a'
            });
        }
    },

    resize() {
        this.canvas.width = window.innerWidth > 430 ? 430 : window.innerWidth;
        this.canvas.height = window.innerHeight;
        this.entities.hero.y = this.canvas.height - 200;
    },

    start() {
        document.getElementById('screen-start').classList.add('hidden');
        this.running = true;
        this.lastT = performance.now();
        requestAnimationFrame((t) => this.loop(t));
    },

    loop(t) {
        if(!this.running) return;
        const dt = (t - this.lastT) / 1000;
        this.lastT = t;
        
        this.update(dt);
        this.draw();
        requestAnimationFrame((nt) => this.loop(nt));
    },

    update(dt) {
        this.timer -= dt;
        if(this.timer <= 0) this.win();

        // 1. Stars (Parallax)
        this.entities.stars.forEach(s => {
            s.y += s.s;
            if(s.y > this.canvas.height) s.y = -10;
        });

        // 2. Hero Logic (Auto-Strafe & Fire)
        const h = this.entities.hero;
        h.y = (this.canvas.height - 200) + Math.sin(Date.now()/400) * 30;
        if(Math.random() > 0.95) this.entities.bullets.push({ x: 100, y: h.y + 28, vx: 18 });

        // 3. Boss Logic
        const b = this.entities.boss;
        b.y = 200 + Math.sin(Date.now()/1200) * 60;
        if(b.flash > 0) b.flash--;

        // 4. Bullet Collision & Particles
        this.entities.bullets.forEach((bul, i) => {
            bul.x += bul.vx;
            if(bul.x > this.canvas.width - 140 && bul.y > b.y && bul.y < b.y + 180) {
                b.hp -= 5; b.flash = 4;
                this.entities.bullets.splice(i, 1);
                // Burst FX
                for(let j=0; j<6; j++) {
                    this.entities.fx.push({
                        x: bul.x, y: bul.y, 
                        vx: Math.random()*8, vy: (Math.random()-0.5)*15, 
                        l: 25, c: '#0f0' 
                    });
                }
            }
            if(bul.x > this.canvas.width) this.entities.bullets.splice(i, 1);
        });

        this.entities.fx.forEach((f, i) => { f.x += f.vx; f.y += f.vy; f.l--; if(f.l <= 0) this.entities.fx.splice(i,1); });

        // UI SYNC
        const m = Math.floor(this.timer/60), s = Math.floor(this.timer%60);
        document.getElementById('timer-text').innerText = `${m}:${s < 10 ? '0'+s : s}`;
        document.getElementById('hp-fill').style.width = (b.hp / 2000 * 100) + "%";
        document.getElementById('ui-streak').innerText = this.data.streak;
    },

    draw() {
        const ctx = this.ctx;
        ctx.fillStyle = '#000'; ctx.fillRect(0,0,this.canvas.width, this.canvas.height);

        // Background
        this.entities.stars.forEach(s => { ctx.fillStyle = s.c; ctx.fillRect(s.x, s.y, 2, 2); });

        // Hero (The Armoured Suit)
        const h = this.entities.hero;
        ctx.fillStyle = '#ff7b00'; ctx.fillRect(60, h.y, 45, 70); // Body
        ctx.fillStyle = '#00ff41'; ctx.fillRect(85, h.y+10, 20, 10); // Visor
        ctx.fillStyle = '#777'; ctx.fillRect(95, h.y+28, 25, 14); // Cannon

        // Boss (The Omega Cavity)
        const b = this.entities.boss;
        ctx.fillStyle = b.flash > 0 ? '#fff' : '#333';
        ctx.fillRect(this.canvas.width - 130, b.y, 110, 190);
        ctx.fillStyle = b.flash > 0 ? '#f00' : '#800'; 
        ctx.beginPath(); ctx.arc(this.canvas.width-85, b.y+70, 25, 0, Math.PI*2); ctx.fill(); // Pulsing Eye

        // Bullets & FX
        ctx.fillStyle = 'cyan'; this.entities.bullets.forEach(bul => ctx.fillRect(bul.x, bul.y, 20, 5));
        this.entities.fx.forEach(f => { ctx.fillStyle = `rgba(0,255,0,${f.l/25})`; ctx.fillRect(f.x, f.y, 3, 3); });
    },

    win() {
        this.running = false;
        this.data.streak++;
        localStorage.setItem('brush_v4_data', JSON.stringify(this.data));
        document.getElementById('screen-win').classList.remove('hidden');
    }
};

engine.init();
</script>
</body>
</html>
