<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tooth Ranger: Plaque Planet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;background:#060913;color:white;font-family:sans-serif;display:flex;justify-content:center;}
.app{width:100%;max-width:430px;padding:12px;display:flex;flex-direction:column;min-height:100vh;}
h1{text-align:center;color:#0ff;font-family:Orbitron,sans-serif;font-size:20px;margin-bottom:8px;}
#timer{font-family:Orbitron,sans-serif;font-size:48px;text-align:center;margin:6px 0;}
#timer.danger{color:#f22;animation:flash 0.5s infinite;}
@keyframes flash{50%{opacity:0.3}}
#zone{text-align:center;font-size:12px;margin-bottom:4px;color:#0ff;}
canvas{width:100%;height:260px;background:black;border-radius:18px;box-shadow:0 0 30px rgba(0,255,255,0.2);}
.controls{display:flex;justify-content:space-between;margin-top:6px;}
button{flex:1;margin:2px;padding:12px;border:none;border-radius:12px;background:#111;color:white;font-weight:600;}
button.primary{background:#0ff;color:black;}
#stats{text-align:center;font-size:12px;margin-top:6px;opacity:0.8;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;flex-direction:column;}
.lootbox{background:#111;padding:24px;border-radius:20px;text-align:center;}
.crystal{font-size:50px;animation:spin 2s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}
.parent{text-align:center;font-size:11px;opacity:0.5;margin-top:auto;}
</style>
</head>
<body>
<div class="app">
<h1>TOOTH RANGER</h1>
<div id="timer">2:00</div>
<div id="zone"></div>
<canvas id="game" width="400" height="260"></canvas>
<div class="controls">
<button class="primary" onclick="Game.start()">Start</button>
<button onclick="Game.pause()">Pause</button>
<button onclick="Game.reset()">Reset</button>
</div>
<div id="stats"></div>
<div class="parent">
<button onclick="Game.parentAdjust()">Parent Controls</button>
</div>
</div>

<div class="overlay" id="lootOverlay">
<div class="lootbox">
<h2>Mission Complete</h2>
<div class="crystal">ðŸ’Ž</div>
<p id="lootText"></p>
<button onclick="Game.closeLoot()">Continue</button>
</div>
</div>

<script>
const Game={
TOTAL:120,
time:120,
state:"idle",
zoneIndex:0,
crystals:Number(localStorage.getItem("crystals")||0),
streak:Number(localStorage.getItem("streak")||0),
daily:Number(localStorage.getItem("daily")||0),
lastDate:localStorage.getItem("lastDate")||"",
bossHealth:100,
particles:[],
canvas:null,
ctx:null,
lastFrame:0,
heroSprite:null,
bossSprite:null,

init(){
this.canvas=document.getElementById("game");
this.ctx=this.canvas.getContext("2d");
this.loadSprites();
requestAnimationFrame(this.loop.bind(this));
this.updateStats();
},

loadSprites(){
// Hero sprite: embedded Base64 PNG 32x32px (simplified)
this.heroSprite=new Image();
this.heroSprite.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPklEQVRYR+2XwQ2DMBBFz0sC3WA7YOwKdwcGhUQ6qIOwYVsT6iwRCjVxZJvKpAKxZlz+/pJnR4LtwAi+vB2A+wB1i12fBlp87iBzBkegmZV+GbgzZpB0id5a8vPshqF8A4Ixw3xtqVne6O3NANuQxwBv4Aykf3LxphmU40EyOkq5Vx2YvQ4F6lCvl7cHQrMEt40FVpIsIUQkQpWQ9vgiR9d0EQuEokxRyK+HBkSmm/BChF3F/1z5slAFU1RojGKwWGl1H+gPwR7Ch0zxGfwO+gEjEr0q7QLnqgM8NqUBwBD2fZQtrHJxM6yqAhTkP2zmgWqJE1QnKxjTgnrkvbBq2gb0cH8Y6ErX8t1KwMnK3wKlmGrVxoOqQwAAAABJRU5ErkJggg==";
// Boss sprite: embedded Base64 PNG 64x64px
this.bossSprite=new Image();
this.bossSprite.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAABH9v8kAAAAQ0lEQVR42mNgGAWjYBSMglEwCqIgglEE6QAcYHnYgDqEPCsDhA7g1QvAeCkgd4XgAAxrjGzQAAByYXHxFXjK50AAAAASUVORK5CYII=";
},

start(){
if(this.state==="running")return;
this.state="countdown";
let count=5;
document.getElementById("timer").textContent="Deploy in 5";
let pre=setInterval(()=>{
count--;
if(count>0){document.getElementById("timer").textContent="Deploy in "+count;}
else{
clearInterval(pre);
this.state="running";
this.time=this.TOTAL;
this.bossHealth=100;
}
},1000);
},

pause(){if(this.state==="running")this.state="paused";else if(this.state==="paused")this.state="running";},

reset(){
this.state="idle";
this.time=this.TOTAL;
this.bossHealth=100;
document.getElementById("timer").classList.remove("danger");
document.getElementById("timer").textContent="2:00";
},

loop(ts){
let delta=(ts-this.lastFrame)/1000;
this.lastFrame=ts;
if(this.state==="running"){
this.time-=delta;
if(this.time<=0){this.complete();}
this.bossHealth=(this.time/this.TOTAL)*100;
this.updateTimer();
this.updateZone();
this.updateParticles();
}
this.render();
requestAnimationFrame(this.loop.bind(this));
},

updateTimer(){
let t=Math.max(0,Math.floor(this.time));
let m=Math.floor(t/60);
let s=t%60;
let el=document.getElementById("timer");
el.textContent=`${m}:${s.toString().padStart(2,"0")}`;
if(t<=10){
el.classList.add("danger");
this.alarm();
}else el.classList.remove("danger");
},

updateZone(){
let z=Math.floor((this.TOTAL-this.time)/30);
const zones=["Upper Left Sector","Upper Right Sector","Lower Left Sector","Core Chamber"];
document.getElementById("zone").textContent=zones[z]||"";
},

render(){
const ctx=this.ctx;
ctx.clearRect(0,0,400,260);
// Parallax background
ctx.fillStyle="#0a0f22";ctx.fillRect(0,0,400,260);
ctx.fillStyle="#141c3f";for(let i=0;i<30;i++){ctx.fillRect((i*50+Date.now()/20)%400,200,20,60);}
// Hero
ctx.drawImage(this.heroSprite,60,160,32,32);
// Boss
ctx.fillStyle=this.bossHealth>60?"#f22":this.bossHealth>30?"#f90":"#666";
ctx.drawImage(this.bossSprite,280,100,64,64);
// Particles
this.particles.forEach(p=>{ctx.fillStyle=p.color;ctx.fillRect(p.x,p.y,2,2);});
},

updateParticles(){this.particles.forEach(p=>{p.life-=1/60;p.y-=1;});this.particles=this.particles.filter(p=>p.life>0);},

complete(){
this.state="complete";
let today=new Date().toDateString();
if(today!==this.lastDate){this.daily++;this.streak++;this.lastDate=today;}
let reward=Math.floor(Math.random()*20)+15;
this.crystals+=reward;
this.save();
this.updateStats();
document.getElementById("lootText").textContent="You earned "+reward+" Crystals";
document.getElementById("lootOverlay").style.display="flex";
},

closeLoot(){document.getElementById("lootOverlay").style.display="none";this.reset();},

parentAdjust(){
let d=prompt("Daily count:");let s=prompt("Streak:");
if(d!==null)this.daily=Number(d);if(s!==null)this.streak=Number(s);
this.save();this.updateStats();
},

updateStats(){
document.getElementById("stats").textContent="Crystals: "+this.crystals+" | Streak: "+this.streak+" | Today: "+this.daily;
},

save(){
localStorage.setItem("crystals",this.crystals);
localStorage.setItem("streak",this.streak);
localStorage.setItem("daily",this.daily);
localStorage.setItem("lastDate",this.lastDate);
},

alarm(){let ctxAudio=new(window.AudioContext||window.webkitAudioContext)();let osc=ctxAudio.createOscillator();osc.frequency.value=600;osc.connect(ctxAudio.destination);osc.start();osc.stop(ctxAudio.currentTime+0.05);}
};

Game.init();
</script>
</body>
</html>
